{"id":1518,"date":"2014-05-25T20:09:56","date_gmt":"2014-05-25T20:09:56","guid":{"rendered":"http:\/\/opencontrail.org\/?p=1518"},"modified":"2014-05-25T20:09:56","modified_gmt":"2014-05-25T20:09:56","slug":"how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw","status":"publish","type":"post","link":"https:\/\/tungsten.io\/how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw\/","title":{"rendered":"How to setup OpenContrail Gateway &#8211; Juniper MX, Cisco ASR and Software GW"},"content":{"rendered":"<p><em><strong>Note: This blog is done with user\u2019s own lab environment and all third party references\/performance characterization needs to be\u00a0verified with third party vendor in question.<\/strong><\/em><\/p>\n<p><span style=\"text-decoration: underline;\"><em><strong>OPENCONTRAIL GATEWAYS &#8211; Use Cases and Setup Guide <\/strong><\/em><\/span><\/p>\n<h5><strong>1 INTRODUCTION<\/strong><\/h5>\n<p>Gateway in a virtualized network refers to an entity that allows network traffic to move back and forth between the virtual and the physical networks or between virtual networks operating on different set of technologies. In many cases, the virtual network is created using overlay (i.e. tunneling) technologies and, therefore, a gateway needs to understand the protocols of the overlay network traffic in order to allow traffic to pass back and forth through it.<br \/>\n<!--more Read more...--><\/p>\n<p>OpenContrail is based on a standard-based control plane protocols and encapsulation mechanisms to operate. As a result of this approach, industry standard routing platforms can be used as gateways to the virtual networks differentiating OpenContrail from some of the available solutions. In this blog, we will see various approaches in setting up and using a Gateway to a OpenContrail Cloud. In particular, we will focus on three different gateways options which will also cover a vendor agnostic solution and a virtualized gateway as an option. Following gateway options will be covered &#8211;<\/p>\n<ol>\n<li>Juniper MX<\/li>\n<li>Cisco ASR 903<\/li>\n<li>Software Gateway<\/li>\n<\/ol>\n<h5><strong>2 Use Cases that require a Gateway to a Cloud Environment<\/strong><\/h5>\n<h6><strong>2.1 Hybrid Cloud Use Case<\/strong><\/h6>\n<p>In this use case, a gateway is required to have an enterprise private cloud connect to a public cloud environment (like AWS)\u00a0 VPC gateway<\/p>\n<p><a href=\"http:\/\/opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Hybrid-Cloud-Use-Case-Picture-GW-Blog.png\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-full wp-image-5718\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Hybrid-Cloud-Use-Case-Picture-GW-Blog.png\" alt=\"OpenContrail-Hybrid-Cloud-Use-Case-Picture-GW-Blog\" width=\"983\" height=\"426\" data-id=\"5718\" \/><\/a><\/p>\n<h6><strong>2.2 Data Center Interconnect &#8211; A Distributed Cloud Scenario<\/strong><\/h6>\n<p>In this use case, multi-site Data Centers are interconnected to create a distributed cloud environment by constructing a L3VPN domain over EBGP across the gateways<\/p>\n<p><a href=\"http:\/\/opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Data-Center-Interconnect-Use-Case-Picture-GW-Blog.png\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone wp-image-5720\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Data-Center-Interconnect-Use-Case-Picture-GW-Blog.png\" alt=\"OpenContrail-Data-Center-Interconnect-Use-Case-Picture-GW-Blog\" width=\"1000\" height=\"479\" data-id=\"5720\" \/><\/a><\/p>\n<h6><strong>2.3 Cloud Interconnect + NFV Security Service via L3 VPN Gateway<\/strong><\/h6>\n<p>BGP MPLS VPN capable Data Center Gateway Router device allows for providing connectivity between the Enterprise customer\u2019s virtual network assets residing in the Data Center and the existing physical PIP L3 VPN network using a standard Inter-AS VPN connectivity methodology. The Data Center edge router will act in an Inter-AS VPN ASBR role bridging the ASN used in the Contrail virtual-network overlay topology to the ASN used in the service provider L3 VPN core.<\/p>\n<p><a href=\"http:\/\/opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Cloud-Interconnect-Security-NFV-Picture-BLOG.bmp\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-medium wp-image-1522\" src=\"http:\/\/opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Cloud-Interconnect-Security-NFV-Picture-BLOG.bmp\" alt=\"OpenContrail Cloud Interconnect Security NFV Picture BLOG\" width=\"1\" height=\"1\" data-id=\"1522\" \/><\/a><a href=\"http:\/\/opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Cloud-Interconnect-Security-NFV-Picture-BLOG.bmp\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-medium wp-image-1522\" src=\"http:\/\/opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Cloud-Interconnect-Security-NFV-Picture-BLOG.bmp\" alt=\"OpenContrail Cloud Interconnect Security NFV Picture BLOG\" width=\"1\" height=\"1\" data-id=\"1522\" \/><\/a><a href=\"http:\/\/opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Cloud-Interconnect-Security-NFV-Picture-BLOG.bmp\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-medium wp-image-1522\" src=\"http:\/\/opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Cloud-Interconnect-Security-NFV-Picture-BLOG.bmp\" alt=\"OpenContrail Cloud Interconnect Security NFV Picture BLOG\" width=\"1\" height=\"1\" data-id=\"1522\" \/><\/a><a href=\"http:\/\/opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Cloud-Interconnect-Security-NFV-Picture-for-Blog.png\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-full wp-image-5721\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Cloud-Interconnect-Security-NFV-Picture-for-Blog.png\" alt=\"OpenContrail-Cloud-Interconnect-Security-NFV-Picture-for-Blog\" width=\"687\" height=\"380\" data-id=\"5721\" \/><\/a><\/p>\n<h6><strong>2.4 Software Gateway to a Virtualized Cloud<\/strong><\/h6>\n<p><a href=\"http:\/\/opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Software-as-a-GW-Picture-BLOG.png\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-full wp-image-5722\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Software-as-a-GW-Picture-BLOG.png\" alt=\"OpenContrail-Software-as-a-GW-Picture-BLOG\" width=\"476\" height=\"360\" data-id=\"5722\" \/><\/a><\/p>\n<h5><strong>3 What does a Gateway need?\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0<\/strong><\/h5>\n<p>A L3 gateway to OpenContrail virtual cloud environment requires standard feature to be supported for control plane signaling<\/p>\n<ol>\n<li>L3VPN<\/li>\n<li>MBGP<\/li>\n<\/ol>\n<p>And the following for Data plane functionality<\/p>\n<p>3. Dynamic GRE tunnels<\/p>\n<h5><strong>4 Juniper MX as a Gateway<\/strong><\/h5>\n<p>In this section, we will cover Junos configuration elements required to enable MX as a gateway router to a OpenContrail cloud environment.<\/p>\n<ol>\n<li>Routing instance for the virtual network\u2019s prefixes to show up<\/li>\n<li>Logical tunnels or Rib groups to leak route between routing instances or inet.0<\/li>\n<li>Dynamic tunnel to enable GRE tunnels to<\/li>\n<\/ol>\n<p>Here are the MX configuration snippets:<\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code> sroot&gt; show configuration\n ##Enables Dynamic Tunnels on the chassis\n chassis {\n fpc 0 {\n pic 0 {\n tunnel-services;\n }\n }\n }\n interfaces {\n ## For Route leaking between Contrail VRF for Public access and\u00a0 Global Routing Table\n lt-0\/0\/0 {\n unit 0 {\n encapsulation frame-relay;\n dlci 1;\n peer-unit 1;\n family inet;\n }\n unit 1 {\n encapsulation frame-relay;\n dlci 1;\n peer-unit 0;\n family inet;\n }\n }\n routing-options {\n static {\n route 0.0.0.0\/0 next-hop 10.84.18.254;\n route 10.84.53.80\/28 next-hop lt-0\/0\/0.0;\n }\n route-distinguisher-id 10.84.18.253;\n autonomous-system 64512;\n ## Dynamic Tunnel config with source and destination networks. For each destination network learnt over BGP, there is a dynamic GRE tunnel automatically established to the Compute node.\n dynamic-tunnels {\n dynamic_overlay_tunnels {\n source-address 10.84.18.253;\n gre;\n destination-networks {\n 10.84.18.0\/24;\n }\n }\n }\n }\n protocols {\n mpls {\n interface all;\n }\n ## Control path , BGP peering to each control node\n bgp {\n group Contrail_Controller {\n type internal;\n local-address 10.84.18.253;\n keep all;\n family inet-vpn {\n unicast;\n }\n neighbor 10.84.18.12; #Contrail Control node 1\n neighbor 10.84.18.13; #Contrail Control node 2\n }\n }\n }\n routing-instances {\n ## Usually, one VRF per Cluster\n public {\n instance-type vrf;\n interface lt-0\/0\/0.1;\n vrf-target target:64512:10000;\n routing-options {\n static {\n route 0.0.0.0\/0 next-hop lt-0\/0\/0.1; #Default route\n }\n }\n }\n }\n Some CLI\/Operation commands to verify Control and Data path:\n ##Upon\u00a0 Configuring the BGP peering on Contrail Web UI\n root&gt; show bgp summary\n Groups: 1 Peers: 2 Down peers: 0\n Table\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Tot Paths\u00a0 Act Paths Suppressed\u00a0\u00a0\u00a0 History Damp State\u00a0\u00a0\u00a0 Pending\n bgp.l3vpn.0\n 78\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 69\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0\n Peer\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 AS\u00a0\u00a0\u00a0\u00a0\u00a0 InPkt\u00a0\u00a0\u00a0\u00a0 OutPkt\u00a0\u00a0\u00a0 OutQ\u00a0\u00a0 Flaps Last Up\/Dwn State|#Active\/Received\/Accepted\/Damped...\n 10.84.18.12\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 64512\u00a0\u00a0\u00a0\u00a0\u00a0 22019\u00a0\u00a0\u00a0\u00a0\u00a0 23624\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1\u00a0\u00a0\u00a0\u00a0 1w0d12h Establ\n bgp.l3vpn.0: 9\/9\/9\/0\n public.inet.0: 1\/1\/1\/0\n 10.84.18.13\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 64512\u00a0\u00a0\u00a0\u00a0\u00a0 22023\u00a0\u00a0\u00a0\u00a0\u00a0 23624\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1\u00a0\u00a0\u00a0\u00a0 1w0d12h Establ\n bgp.l3vpn.0: 0\/9\/9\/0\n public.inet.0: 0\/1\/1\/0<\/code><code>\n ## Routes being advertised by 18.13 control node\n root&gt; show route receive-protocol bgp 10.84.18.13\n ..\n public.inet.0: 4 destinations, 6 routes (4 active, 0 holddown, 0 hidden)\n Prefix\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Nexthop\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 MED\u00a0\u00a0\u00a0\u00a0 Lclpref\u00a0\u00a0\u00a0 AS path\n 10.84.53.93\/32\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 10.84.18.13\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 100\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ?\n bgp.l3vpn.0: 69 destinations, 78 routes (69 active, 0 holddown, 0 hidden)\n Prefix\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Nexthop\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 MED\u00a0\u00a0\u00a0\u00a0 Lclpref\u00a0\u00a0\u00a0 AS path\n 10.84.18.13:1:0.0.0.0\/0\n 10.84.18.13\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 100\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ?\n 10.84.18.13:1:1.0.2.253\/32\n 10.84.18.13\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 100\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ?\n 10.84.18.13:1:10.84.53.93\/32\n 10.84.18.13\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 100\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ?\n 10.84.18.13:1:192.168.10.252\/32\n 10.84.18.13\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 100\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ?\n 10.84.18.13:1:192.168.10.253\/32\n 10.84.18.13\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 100\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ?\n 10.84.18.13:2:10.84.53.93\/32\n 10.84.18.13\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 100\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ?\n 10.84.18.13:3:250.250.1.253\/32\n 10.84.18.13\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 100\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ?\n 10.84.18.14:1:192.168.20.253\/32\n 10.84.18.14\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 100\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ?\n 10.84.18.14:2:250.250.2.253\/32\n 10.84.18.14\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 100\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ?\n ## To reach 10.84.53.93 VM, dynamic GRE tunnel path from Gateway to the compute node hosting the VM\n root&gt; show route 10.84.53.93\/32\n public.inet.0: 4 destinations, 6 routes (4 active, 0 holddown, 0 hidden)\n + = Active Route, - = Last Active, * = Both\n 10.84.53.93\/32\u00a0\u00a0\u00a0\u00a0 *[BGP\/170] 20:40:33, localpref 100, from 10.84.18.12\n AS path: ?, validation-state: unverified\n &gt; via gr-0\/0\/0.32772, Push 22\n [BGP\/170] 20:40:33, localpref 100, from 10.84.18.13\n AS path: ?, validation-state: unverified\n &gt; via gr-0\/0\/0.32772, Push 22<\/code><\/span><\/pre>\n<h5><strong>5 ASR 903 as a Gateway<\/strong><\/h5>\n<p>Configuration below covers leveraging Cisco ASR1k as a Gateway<\/p>\n<pre><code><span style=\"font-family: 'courier new', courier;\"> \nasr903#show running-config \nBuilding configuration...\n\nCurrent configuration : 4347 bytes\n!\n! Last configuration change at 14:20:21 UTC Tue Aug 25 2015\n!\nversion 15.2\nno service pad\nservice timestamps debug datetime msec\nservice timestamps log datetime msec\nno platform punt-keepalive disable-kernel-core\n!\nhostname asr903\n!\nboot-start-marker\nboot system bootflash:Image\/packages.conf\nboot-end-marker\n!\n!\nvrf definition Contrail\n rd 64512:10000\n route-target export 64512:10000\n route-target import 64512:10000\n !\n address-family ipv4\n exit-address-family\n !\n address-family ipv6\n exit-address-family\n!\nvrf definition Mgmt-intf\n !\n address-family ipv4\n exit-address-family\n !\n address-family ipv6\n exit-address-family\n!\nenable secret 5 $1$RAyL$SjMKm.r.vzr3sXehjMYNv1\n!\nno aaa new-model\n!\nip vrf mgre\n rd 1:1\n!\nip domain name englab.juniper.net\n!\n!         \n!\nipv6 multicast rpf use-bgp\n!\n!\nmultilink bundle-name authenticated\n!\n!\nredundancy\n mode sso\n!\ncontroller wanphy 0\/0\/0\n!\ncontroller wanphy 0\/1\/0\n!\ncontroller wanphy 0\/2\/0\n!\ncontroller wanphy 0\/3\/0\n!\n!\n!\nip tftp source-interface GigabitEthernet0\nlldp run\n!         \n!\n!\n!\n!\ninterface Loopback10\n no ip address\n!\ninterface Loopback30\n vrf forwarding Contrail\n ip address 30.30.40.253 255.255.255.255\n!\ninterface Loopback100\n vrf forwarding Contrail\n ip address 10.250.250.10 255.255.255.255\n!\ninterface Loopback102\n ip address 192.0.2.1 255.255.255.255\n!\ninterface Loopback103\n ip address 192.0.2.2 255.255.255.255\n!\ninterface Tunnel102\n ip address 192.168.0.129 255.255.255.252\n tunnel source Loopback102\n tunnel destination 192.0.2.2\n!\ninterface Tunnel103\n vrf forwarding Contrail\n ip address 192.168.0.130 255.255.255.252\n tunnel source Loopback103\n tunnel destination 192.0.2.1\n!\ninterface TenGigabitEthernet0\/0\/0\n no ip address\n shutdown\n!\ninterface TenGigabitEthernet0\/1\/0\n no ip address\n shutdown\n!\ninterface TenGigabitEthernet0\/2\/0\n no ip address\n shutdown\n!\ninterface TenGigabitEthernet0\/3\/0\n no ip address\n shutdown\n!\ninterface GigabitEthernet0\/4\/0\n ip address 10.84.40.190 255.255.255.224\n negotiation auto\n!\ninterface GigabitEthernet0\/4\/1\n vrf forwarding Contrail\n ip address 30.30.0.3 255.255.255.0\n no ip redirects\n ip local-proxy-arp\n ip route-cache same-interface\n negotiation auto\n!\ninterface GigabitEthernet0\/4\/2\n no ip address\n shutdown\n negotiation auto\n!\ninterface GigabitEthernet0\/4\/3\n no ip address\n shutdown\n negotiation auto\n!\ninterface GigabitEthernet0\/4\/4\n no ip address\n shutdown\n negotiation auto\n!\ninterface GigabitEthernet0\/4\/5\n no ip address\n shutdown\n negotiation auto\n!\ninterface GigabitEthernet0\/4\/6\n no ip address\n shutdown\n negotiation auto\n!\ninterface GigabitEthernet0\/4\/7\n ip address 10.84.40.253 255.255.255.192\n negotiation auto\n cdp enable\n!\ninterface GigabitEthernet0\n vrf forwarding Mgmt-intf\n ip address 10.84.61.201 255.255.254.0\n negotiation auto\n!\nl3vpn encapsulation ip MGRE\n transport ipv4 source GigabitEthernet0\/4\/7\n !\nrouter ospf 101 vrf Contrail\n redistribute connected\n redistribute static\n network 192.0.2.130 0.0.0.0 area 0\n!\nrouter ospf 100\n redistribute connected\n redistribute static\n network 192.0.2.129 0.0.0.0 area 0\n!\nrouter bgp 64512\n bgp router-id 10.84.40.253\n bgp log-neighbor-changes\n neighbor 10.84.30.39 remote-as 64512\n neighbor 10.84.30.39 update-source GigabitEthernet0\/4\/7\n !\n address-family ipv4\n  no neighbor 10.84.30.39 activate\n  default-information originate\n exit-address-family\n !\n address-family vpnv4\n  neighbor 10.84.30.39 activate\n  neighbor 10.84.30.39 send-community extended\n  neighbor 10.84.30.39 route-map SELECT_UPDATE_FOR_L3VPN in\n exit-address-family\n !\n address-family ipv4 vrf Contrail\n  redistribute connected\n  redistribute static\n  default-information originate\n exit-address-family\n!\nno ip forward-protocol nd\n!\nno ip http server\nip route 0.0.0.0 0.0.0.0 10.84.40.254\nip route 10.84.40.0 255.255.255.192 10.84.40.189\nip route 10.84.40.64 255.255.255.192 10.84.40.189\nip route 10.84.40.128 255.255.255.224 192.168.0.130\nip route vrf Contrail 0.0.0.0 0.0.0.0 192.168.0.129\nip route vrf Contrail 5.5.5.0 255.255.255.0 Null0\n!\ncdp run\n!\nroute-map setnh-out permit 10\n!\nroute-map SELECT_UPDATE_FOR_L3VPN permit 10\n  set ip next-hop encapsulate l3vpn MGRE\n!\nroute-map set-nh permit 10\n!\nroute-map set-nh permit 20\n!\nroute-map set-nh-contrail permit 10\n!\nroute-map set-nh-ip permit 200\n!\n!\n!\ncontrol-plane\n!\n!\nline con 0\n stopbits 1\nline aux 0\n stopbits 1\nline vty 0 4\n exec-timeout 0 0\n no login\nline vty 5 16\n exec-timeout 0 0\n login\n!\n!\n!\nend\n\nasr903#                                                 \nasr903#show ip route vrf Contrail \n\nRouting Table: Contrail\nCodes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP\n       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area \n       N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2\n       E1 - OSPF external type 1, E2 - OSPF external type 2\n       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2\n       ia - IS-IS inter area, * - candidate default, U - per-user static route\n       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP\n       + - replicated route, % - next hop override\n\nGateway of last resort is 192.168.0.129 to network 0.0.0.0\n\nS*    0.0.0.0\/0 [1\/0] via 192.168.0.129\n      5.0.0.0\/24 is subnetted, 1 subnets\nS        5.5.5.0 is directly connected, Null0\n      10.0.0.0\/32 is subnetted, 2 subnets\nB        10.84.40.131 [200\/0] via 10.84.30.39, 00:22:56, Tunnel0\nC        10.250.250.10 is directly connected, Loopback100\n      30.0.0.0\/8 is variably subnetted, 3 subnets, 2 masks\nC        30.30.0.0\/24 is directly connected, GigabitEthernet0\/4\/1\nL        30.30.0.3\/32 is directly connected, GigabitEthernet0\/4\/1\nC        30.30.40.253\/32 is directly connected, Loopback30\n      192.168.0.0\/24 is variably subnetted, 2 subnets, 2 masks\nC        192.168.0.128\/30 is directly connected, Tunnel103\nL        192.168.0.130\/32 is directly connected, Tunnel103\nasr903# \nasr903#\nasr903#sh\nasr903#show ip route vrf Contrail 10.84.40.131\n\nRouting Table: Contrail\nRouting entry for 10.84.40.131\/32\n  Known via \"bgp 64512\", distance 200, metric 0, type internal\n  Last update from 10.84.30.39 on Tunnel0, 00:23:08 ago\n  Routing Descriptor Blocks:\n  * 10.84.30.39 (default), from 10.84.30.39, 00:23:08 ago, via Tunnel0\n      Route metric is 0, traffic share count is 1\n      AS Hops 0\n      MPLS label: 20\n      MPLS Flags: MPLS Required\nasr903#\nasr903#\n\nasr903#show ip cef vrf Contrail 10.84.40.131 detail \n10.84.40.131\/32, epoch 2, flags rib defined all labels\n  nexthop 10.84.30.39 Tunnel0 label 20\nasr903#\n\nasr903#show tunnel endpoints \n Tunnel0 running in multi-GRE\/IP mode\n\n Endpoint transport 10.84.30.39 Refcount 3 Base 0x3067EEF8 Create Time 00:23:56\n   overlay 10.84.30.39 Refcount 2 Parent 0x3067EEF8 Create Time 00:23:56\nasr903#\n\nasr903#show l3vpn encapsulation ip MGRE \n\n Profile: MGRE\n  transport ipv4 source GigabitEthernet0\/4\/7\n  protocol gre\n  payload mpls\n   mtu default\n  Tunnel Tunnel0 Created [OK]\n  Tunnel Linestate [OK]\n  Tunnel Transport Source GigabitEthernet0\/4\/7 [OK]\nasr903#\nasr903#\n <\/span><\/code><\/pre>\n<p><strong><br \/>\n6 Software Gateway<\/strong><br \/>\nIn this section, we will see configuration snippets for using Juniper a virtual SRX (firefly perimeter) as a Software gateway to OpenContrail Cloud. Additional details including configuration is published in the link below and is very similar to the Junos MX gateway configuration<\/p>\n<p><a href=\"http:\/\/www.juniper.net\/techpubs\/en_US\/contrail2.21\/topics\/task\/configuration\/simple-gateway-support-vnc.html\">http:\/\/www.juniper.net\/techpubs\/en_US\/contrail2.21\/topics\/task\/configuration\/simple-gateway-support-vnc.html<\/a><\/p>\n<p><strong>7 CONCLUSION<\/strong><\/p>\n<p>OpenContrail uses truly open standard based control and data plane signaling and hence can interoperate with any standard gateway to realize real complex use cases.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Note: This blog is done with user\u2019s own lab environment and all third party references\/performance characterization needs to be\u00a0verified with third party vendor in question. OPENCONTRAIL GATEWAYS &#8211; Use Cases&#8230;<\/p>\n","protected":false},"author":475,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[13,6,7,8],"tags":[],"acf":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v21.6 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>How to setup OpenContrail Gateway - Juniper MX, Cisco ASR and Software GW - Tungsten Fabric<\/title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/tungsten.io\/how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"How to setup OpenContrail Gateway - Juniper MX, Cisco ASR and Software GW - Tungsten Fabric\" \/>\n<meta property=\"og:description\" content=\"Note: This blog is done with user\u2019s own lab environment and all third party references\/performance characterization needs to be\u00a0verified with third party vendor in question. OPENCONTRAIL GATEWAYS &#8211; Use Cases...\" \/>\n<meta property=\"og:url\" content=\"https:\/\/tungsten.io\/how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw\/\" \/>\n<meta property=\"og:site_name\" content=\"Tungsten Fabric\" \/>\n<meta property=\"article:published_time\" content=\"2014-05-25T20:09:56+00:00\" \/>\n<meta property=\"og:image\" content=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Hybrid-Cloud-Use-Case-Picture-GW-Blog.png\" \/>\n<meta name=\"author\" content=\"Sreelakshmi Sarva\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebPage\",\"@id\":\"https:\/\/tungsten.io\/how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw\/\",\"url\":\"https:\/\/tungsten.io\/how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw\/\",\"name\":\"How to setup OpenContrail Gateway - Juniper MX, Cisco ASR and Software GW - Tungsten Fabric\",\"isPartOf\":{\"@id\":\"https:\/\/tungsten.io\/#website\"},\"datePublished\":\"2014-05-25T20:09:56+00:00\",\"dateModified\":\"2014-05-25T20:09:56+00:00\",\"author\":{\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/ecbd29c3e82e84f75ebec84b7e76d982\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/tungsten.io\/how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw\/\"]}]},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/tungsten.io\/#website\",\"url\":\"https:\/\/tungsten.io\/\",\"name\":\"Tungsten Fabric\",\"description\":\"multicloud multistack SDN\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https:\/\/tungsten.io\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"Person\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/ecbd29c3e82e84f75ebec84b7e76d982\",\"name\":\"Sreelakshmi Sarva\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/image\/\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/12cd9dae2062e082631575d0f6c13092?s=96&d=mm&r=pg\",\"contentUrl\":\"https:\/\/secure.gravatar.com\/avatar\/12cd9dae2062e082631575d0f6c13092?s=96&d=mm&r=pg\",\"caption\":\"Sreelakshmi Sarva\"},\"url\":\"https:\/\/tungsten.io\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"How to setup OpenContrail Gateway - Juniper MX, Cisco ASR and Software GW - Tungsten Fabric","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/tungsten.io\/how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw\/","og_locale":"en_US","og_type":"article","og_title":"How to setup OpenContrail Gateway - Juniper MX, Cisco ASR and Software GW - Tungsten Fabric","og_description":"Note: This blog is done with user\u2019s own lab environment and all third party references\/performance characterization needs to be\u00a0verified with third party vendor in question. OPENCONTRAIL GATEWAYS &#8211; Use Cases...","og_url":"https:\/\/tungsten.io\/how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw\/","og_site_name":"Tungsten Fabric","article_published_time":"2014-05-25T20:09:56+00:00","og_image":[{"url":"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2014\/05\/OpenContrail-Hybrid-Cloud-Use-Case-Picture-GW-Blog.png"}],"author":"Sreelakshmi Sarva","twitter_card":"summary_large_image","schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebPage","@id":"https:\/\/tungsten.io\/how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw\/","url":"https:\/\/tungsten.io\/how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw\/","name":"How to setup OpenContrail Gateway - Juniper MX, Cisco ASR and Software GW - Tungsten Fabric","isPartOf":{"@id":"https:\/\/tungsten.io\/#website"},"datePublished":"2014-05-25T20:09:56+00:00","dateModified":"2014-05-25T20:09:56+00:00","author":{"@id":"https:\/\/tungsten.io\/#\/schema\/person\/ecbd29c3e82e84f75ebec84b7e76d982"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/tungsten.io\/how-to-setup-opencontrail-gateway-juniper-mx-cisco-asr-and-software-gw\/"]}]},{"@type":"WebSite","@id":"https:\/\/tungsten.io\/#website","url":"https:\/\/tungsten.io\/","name":"Tungsten Fabric","description":"multicloud multistack SDN","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https:\/\/tungsten.io\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Person","@id":"https:\/\/tungsten.io\/#\/schema\/person\/ecbd29c3e82e84f75ebec84b7e76d982","name":"Sreelakshmi Sarva","image":{"@type":"ImageObject","inLanguage":"en-US","@id":"https:\/\/tungsten.io\/#\/schema\/person\/image\/","url":"https:\/\/secure.gravatar.com\/avatar\/12cd9dae2062e082631575d0f6c13092?s=96&d=mm&r=pg","contentUrl":"https:\/\/secure.gravatar.com\/avatar\/12cd9dae2062e082631575d0f6c13092?s=96&d=mm&r=pg","caption":"Sreelakshmi Sarva"},"url":"https:\/\/tungsten.io"}]}},"_links":{"self":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/1518"}],"collection":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/users\/475"}],"replies":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/comments?post=1518"}],"version-history":[{"count":0,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/1518\/revisions"}],"wp:attachment":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/media?parent=1518"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/categories?post=1518"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/tags?post=1518"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}