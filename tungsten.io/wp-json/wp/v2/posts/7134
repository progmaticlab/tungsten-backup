{"id":7134,"date":"2016-07-20T17:25:54","date_gmt":"2016-07-21T00:25:54","guid":{"rendered":"http:\/\/www.opencontrail.org\/?p=7134"},"modified":"2016-07-20T17:25:54","modified_gmt":"2016-07-21T00:25:54","slug":"tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail","status":"publish","type":"post","link":"https:\/\/tungsten.io\/tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail\/","title":{"rendered":"Tracing Flows through Virtual Networks and Service Instances in OpenStack and OpenContrail"},"content":{"rendered":"<p><strong><em>This is a guest blog by\u00a0Johnny Chen from AT&amp;T with contributions by\u00a0Qasim Arham, Henon Huang, Vijay Kamisetty from Juniper Networks.<\/em><\/strong><\/p>\n<h2 id=\"Overview\">Overview<\/h2>\n<p>The purpose of this is to lay out a method of tracing flows through OpenStack &amp; Contrail environment with a scaled-out Service Instance (virtual firewall) in the path.<\/p>\n<p>Environment Versions:<br \/>\nOpenStack == Juno (2014.2.4)<br \/>\nContrail == 3.0.0<\/p>\n<p>&nbsp;<\/p>\n<hr \/>\n<h2 id=\"Contents\">Table of Contents<\/h2>\n<p><a href=\"#Overview\">Overview<\/a><\/p>\n<p><a href=\"#Contents\">Table of Contents<\/a><\/p>\n<p><a href=\"#Background_Drawings\">Background &amp; Drawings<\/a><\/p>\n<p><a href=\"#Tracing_Outside_In\">Tracing: Outside =&gt; In<\/a><\/p>\n<p><a href=\"#TOI_Step_1\">Step 1: On the SDNGW, find the NEXT-HOP (NH) to the vFW VM in the routing table<\/a><br \/>\n<a href=\"#TOI_Step_2\">Step 2: Verify Traffic to vFW Service Instance VM Compute<\/a><br \/>\n<a href=\"#TOI_Step_3\">Step 3: Trace Flow into vFW Service Instance VM<\/a><br \/>\n<a href=\"#TOI_Step_4\">Step 4: Verify Traffic is leaving vFW towards DST VM<\/a><br \/>\n<a href=\"#TOI_Step_5\">Step 5: Verify Traffic is getting to DST VM TAP Interface<\/a><br \/>\n<a href=\"#TOI_Step_6\">Step 6: On DST VM, Verify Traffic Inbound<\/a><\/p>\n<p><a href=\"#Tracing_Inside_Out\">Tracing: Inside =&gt; Out<\/a><\/p>\n<p><a href=\"#TIO_Step_1\">Step 1: On DST VM Compute, Trace Return Flow<\/a><br \/>\n<a href=\"#TIO_Step_2\">Step 2: Verify Return Traffic hitting same vFW as Inbound Path<\/a><\/p>\n<p><a href=\"#References\">References<\/a><\/p>\n<hr \/>\n<h2 id=\"Background_Drawings\">Background &amp; Drawings<\/h2>\n<p><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/07\/Tracing-Flows-through-Virtual-Networks-and-Service-Instances_background-drawings.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-full wp-image-7141\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/07\/Tracing-Flows-through-Virtual-Networks-and-Service-Instances_background-drawings.jpg\" alt=\"Tracing Flows through Virtual Networks and Service Instances_background drawings\" width=\"982\" height=\"731\" data-id=\"7141\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<hr \/>\n<h4>Access to some useful elements for this exercise:<\/h4>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div>RESOURCE<\/div>\n<\/td>\n<td>\n<div>DESCRIPTION<\/div>\n<\/td>\n<\/tr>\n<tr>\n<td>\n<div>OpenStack Horizon<\/div>\n<\/td>\n<td>\n<div>OpenStack Horizon Web GUI<\/div>\n<\/td>\n<\/tr>\n<tr>\n<td>\n<div>Juniper Contrail<\/div>\n<\/td>\n<td>\n<div>Contrail Web GUI<\/div>\n<\/td>\n<\/tr>\n<tr>\n<td>\n<div>SDNGW<\/div>\n<\/td>\n<td>\n<div>SDN Gateway<\/div>\n<\/td>\n<\/tr>\n<tr>\n<td>\n<div>Compute<\/div>\n<\/td>\n<td>\n<div>Contrail vRouter Commands and tcpdump<\/div>\n<\/td>\n<\/tr>\n<tr>\n<td>\n<div>Splunk or Juniper JSA\/STRM Console<\/div>\n<\/td>\n<td>\n<div>SEIM Log and Correlation (Optional)<\/div>\n<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<p>Caveat: There is often more than one way to get to the end result so while this is an attempt to document one method, there could be other ways of achieving to a diagnosis. For this example, we will use a lab network depicted in the drawing below as a reference and trace the packet flow between 12.12.0.102 (SRC) and 10.10.0.100 (DST) where the destination is a VM in the Overlay Network.<\/p>\n<p>The flow path is as follows:<br \/>\n12.12.0.102 &lt;&gt; Physical Network &lt;&gt; SDN-GW &lt;&gt; VN_A &lt;&gt; FW Service Instance &lt;&gt; VN_B &lt;&gt; 10.10.0.100<\/p>\n<p>&nbsp;<\/p>\n<hr \/>\n<h2 id=\"Tracing_Outside_In\">Tracing: Outside =&gt; In<\/h2>\n<hr \/>\n<h3 id=\"TOI_Step_1\">STEP 1: On the SDNGW, find the NEXT-HOP (NH) to the vFW VM in the routing table.<\/h3>\n<h4>1a. Single VM or Compute (Single Next-Hop)<\/h4>\n<div>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div><mark>In a single VM architecture for FW, you would see a single next-hop in the table for that routing-instance. However, in the case of a scaled-out service instance, there might be multiple next-hops pointing to the computes where the FW VM\u2019s instantiated on. When dealing with Composite Next-Hop, identifying which FW on which Compute can get tricky (either log into all the FW\u2019s and look through the session tables for the flow in question or use a SEIM or Log Correlator like Splunk or STRM\/JSA). Here, we will focus on Single VM or Compute (Single Next-Hop).<\/mark><\/div>\n<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<\/div>\n<p>&nbsp;<\/p>\n<p>On SDNGW:<\/p>\n<pre>SDNGW&gt; show route <span style=\"color: #ff0000;\"><em><strong>10.10.0.100<\/strong><\/em><\/span>\n\n<span class=\"skimlinks-unlinked\">vntest.inet.0<\/span>: 50 destinations, 150 routes (50 active, 0 holddown, 0 hidden)\n @ = Routing Use Only, # = Forwarding Use Only\n + = Active Route, - = Last Active, * = Both\n\n10.10.0.0\/24 *[BGP\/170] 1w1d 21:30:43, MED 100, localpref 200, from 172.20.0.5\n AS path: ?, validation-state: unverified\n &gt; via <span style=\"color: #ff0000;\"><em><strong>gr-0\/1\/0.19283, Push 31<\/strong><\/em><\/span>\n [BGP\/170] 1w1d 21:30:43, MED 100, localpref 200, from 172.20.0.6\n AS path: ?, validation-state: unverified\n &gt; via gr-0\/1\/0.19283, Push 31\n\nSDNGW&gt; show interfaces <span style=\"color: #ff0000;\"><em><strong>gr-0\/1\/0.19283<\/strong><\/em><\/span>\n Logical interface gr-0\/1\/0.19283 (Index 345) (SNMP ifIndex 526)\n Flags: Up Point-To-Point SNMP-Traps 0x4000 IP-Header <span style=\"color: #ff0000;\"><strong><em>172.20.0.23<\/em><\/strong><\/span>:10.10.10.10:47:df:64:0000000800000000 Encapsulation: GRE-NULL\n Gre keepalives configured: Off, Gre keepalives adjacency state: down\n Input packets : 4332961\n Output packets: 7699862\n Protocol inet, MTU: 9062\n Flags: None\n Protocol mpls, MTU: 9050, Maximum labels: 3\n Flags: None<\/pre>\n<p>Useful Information from Output:<br \/>\n\u2013 <span style=\"color: #ff0000;\"><em><strong>172.20.0.23<\/strong><\/em><\/span>: NEXT-HOP Compute<br \/>\n\u2013 <span style=\"color: #ff0000;\"><em><strong>31<\/strong><\/em><\/span>: Label of NEXT-HOP on Compute<\/p>\n<p>What we find is the GRE interface (Label 31) for the NEXT-HOP points to the COMPUTE at <span style=\"color: #ff0000;\"><em><strong>172.20.0.23<\/strong><\/em><\/span>. You can find which COMPUTE this is via the Contrail WebGUI (Monitor =&gt; Virtual Routers =&gt; [Search Field]<span style=\"color: #ff0000;\"><em><strong>172.20.0.23<\/strong><\/em><\/span> or search for the VHOST0 IP\u2019s of your computes. In this case, the\u00a0COMPUTE\u00a0\u201cHostname\u201d matches with the NEXT-HOP IP <span style=\"color: #ff0000;\"><em><strong>172.20.0.23\u00a0<\/strong><\/em><\/span>matches with COMPUTE<span style=\"color: #ff0000;\"> <em><strong>cmpt001<\/strong><\/em>. <em><strong>cmpt001 <\/strong><\/em><\/span>hosts the VM of the vFW Service Instance that is the next element in the path to the DST VM. From here, go to Step 2.<\/p>\n<h4>1b. Multiple VM \/ Compute (Composite Next-Hop)<\/h4>\n<div>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div><mark>Here, we will focus on Multiple VM\u2019s or Computes (Composite Next-Hop).<\/mark><\/div>\n<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<\/div>\n<p>On SDNGW:<\/p>\n<pre>SDNGW&gt; show route <span style=\"color: #ff0000;\"><em><strong>10.10.0.100<\/strong><\/em><\/span>\n\n<span class=\"skimlinks-unlinked\">vntest.inet.0<\/span>: 70 destinations, 150 routes (70 active, 0 holddown, 0 hidden)\n @ = Routing Use Only, # = Forwarding Use Only\n + = Active Route, - = Last Active, * = Both\n\n10.10.0.0\/24 @[BGP\/170] 1w1d 21:11:22, MED 100, localpref 200, from 172.20.0.4\n AS path: ?, validation-state: unverified\n &gt; via gr-0\/1\/0.74659, Push 62\n [BGP\/170] 1w1d 21:14:54, MED 100, localpref 200, from 172.20.0.5\n AS path: ?, validation-state: unverified\n &gt; via gr-0\/1\/0.19283, Push 31\n [BGP\/170] 1w1d 21:11:22, MED 100, localpref 200, from 172.20.0.6\n AS path: ?, validation-state: unverified\n &gt; via gr-0\/1\/0.74659, Push 62\n [BGP\/170] 1w1d 21:14:54, MED 100, localpref 200, from 172.20.0.6\n AS path: ?, validation-state: unverified\n &gt; via gr-0\/1\/0.19283, Push 31\n #[Multipath\/255] 1w1d 21:13:23, metric 100, metric2 0\n via gr-0\/1\/0.74659, Push 62\n &gt; via gr-0\/1\/0.19283, Push 31\n\nSDNGW&gt; show interfaces <span style=\"color: #ff0000;\"><em><strong>gr-0\/1\/0.19283<\/strong><\/em><\/span>\n Logical interface gr-0\/1\/0.19283 (Index 345) (SNMP ifIndex 526)\n Flags: Up Point-To-Point SNMP-Traps 0x4000 IP-Header <span style=\"color: #ff0000;\"><em><strong>172.20.0.23<\/strong><\/em><\/span>:10.10.10.10:47:df:64:0000000800000000 Encapsulation: GRE-NULL\n Gre keepalives configured: Off, Gre keepalives adjacency state: down\n Input packets : 4332961\n Output packets: 7699862\n Protocol inet, MTU: 9062\n Flags: None\n Protocol mpls, MTU: 9050, Maximum labels: 3\n Flags: None<\/pre>\n<p>If your environment utilizes logging correlation software like the Splunk or Juniper JSA\/STRM, that tool would be useful to figure out which \u201cnext-hop\u201d scaled-out service instance vFW. Otherwise, we will have to log into each vFW and look at the flow or session table entries to figure out which compute is next in path.<\/p>\n<p>Based on the above information, we can see the traffic transit a particular vFW in the scaled-out Service Instance and we can go directly to Compute where that vFW VM resides. If you know which vFW is taking the traffic (we will assume <span style=\"color: #ff0000;\"><em><strong>VFW001<\/strong> <\/em><\/span>in this case), you can look up with COMPUTE that VM is instantiated on and go from there.<\/p>\n<p>Figure out which COMPUTE the ServiceInstance vFW is on:<\/p>\n<pre>toolsvm:~$ nova list | grep -i vfw\n | <span style=\"color: #ff0000;\"><em><strong>a1b2c3d4e5f6g-7h8i-9j0k-1l2m3n4o5p6q<\/strong><\/em><\/span> | <span style=\"color: #ff0000;\"><em><strong>VFW001 <\/strong><\/em><\/span>| ACTIVE | - | Running | ADMIN=192.168.0.194; VN_A=11.11.0.64; LOGNET=192.168.11.65; VN_B=10.10.0.64 |\n | z1y2x3w4v5u6t-7s8r-9q0p-1o2n3m4l5k6j | VFW002 | ACTIVE | - | Running | ADMIN=192.168.0.196; VN_A=11.11.0.66; LOGNET=192.168.11.67; VN_B=10.10.0.65 |\n\ntoolsvm:~$ nova show <span style=\"color: #ff0000;\"><em><strong>a1b2c3d4e5f6g-7h8i-9j0k-1l2m3n4o5p6q<\/strong><\/em><\/span>\n +------------------------------------------+------------------------------------------------------------+\n | Property | Value |\n +------------------------------------------+------------------------------------------------------------+\n | VN_A network | 11.11.0.64 |\n | LOGNET network | 192.168.11.65 |\n | ADMIN network | 192.168.0.194 |\n | VN_B network | 10.10.0.64 |\n | OS-DCF:diskConfig | MANUAL |\n | OS-EXT-AZ:availability_zone | default |\n | OS-EXT-SRV-ATTR:host | <span style=\"color: #ff0000;\"><em><strong>cmpt001 <\/strong><\/em><\/span>|\n | OS-EXT-SRV-ATTR:hypervisor_hostname | cmpt001.<span class=\"skimlinks-unlinked\">test.net<\/span> |\n | OS-EXT-SRV-ATTR:instance_name | instance-00000eef |\n | OS-EXT-STS:power_state | 1 |\n | OS-EXT-STS:task_state | - |\n | OS-EXT-STS:vm_state | active |\n | OS-SRV-USG:launched_at | 2016-06-01T00:35:36.000000 |\n | OS-SRV-USG:terminated_at | - |\n | accessIPv4 | |\n | accessIPv6 | |\n | config_drive | |\n | created | 2016-06-01T00:35:36Z |\n | flavor | flv_vsrx (12345678-012a-3bcd-e4f5-6789g01h2345) |\n | hostId | asdflkijhbalk1h23k132427896r98a7asfhio1u241234iuhewnoafs |\n | id | <span style=\"color: #ff0000;\"><em><strong>a1b2c3d4e5f6g-7h8i-9j0k-1l2m3n4o5p6q<\/strong><\/em><\/span> |\n | image | vsrx15.1x49d30.3 (6baishdu-ewiu-9238-sibh-02394isfoayx) |\n | key_name | - |\n | name | <span style=\"color: #ff0000;\"><em><strong>VFW001<\/strong> <\/em><\/span>|\n | os-extended-volumes:volumes_attached | [] |\n | progress | 0 |\n | security_groups | default |\n | status | ACTIVE |\n | tenant_id | 9asdf2983riahdf9987sdf9ya9sya9sy |\n | updated | 2016-06-01T00:35:36Z |\n | user_id | d8923923hisuadfhf893923h2hfdasfh |\n +------------------------------------------+------------------------------------------------------------+\n\ntoolsvm:~$ for x in $(nova list | grep -i foam | awk {'print $4'}); do nova show $x | sed -n '10p;24p;28p' | awk {'print $4'} | xargs | sed 's\/ \/ || \/g'; done\n<span style=\"color: #ff0000;\"><em><strong> cmpt001 <\/strong><\/em><\/span>|| <span style=\"color: #ff0000;\"><em><strong>a1b2c3d4e5f6g-7h8i-9j0k-1l2m3n4o5p6q<\/strong><\/em><\/span> || <span style=\"color: #ff0000;\"><em><strong>VFW001<\/strong><\/em><\/span>\n cmpt003 || z1y2x3w4v5u6t-7s8r-9q0p-1o2n3m4l5k6j || VFW002<\/pre>\n<p>We see that <span style=\"color: #ff0000;\"><em><strong>VFW001 <\/strong><\/em><\/span>with ID <span style=\"color: #ff0000;\"><em><strong>a1b2c3d4e5f6g-7h8i-9j0k-1l2m3n4o5p6q<\/strong><\/em><\/span> is on COMPUTE <span style=\"color: #ff0000;\"><em><strong>cmpt001<\/strong><\/em><\/span>.<\/p>\n<p><a href=\"https:\/\/packetsio.wordpress.com\/#Overview\">TOP<\/a><\/p>\n<hr \/>\n<h3 id=\"TOI_Step_2\">STEP 2: Verify Traffic is making it into vFW ServiceInstance VM Compute<\/h3>\n<p><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/07\/27440195245_4ffd43cd65_b.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-full wp-image-7139\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/07\/27440195245_4ffd43cd65_b.jpg\" alt=\"27440195245_4ffd43cd65_b\" width=\"674\" height=\"731\" data-id=\"7139\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<h4>2a. Go to COMPUTE<\/h4>\n<pre>toolsvm ~]$ ssh user@cmpt001\n password for [user]:\n Welcome to Ubuntu 14.04.2 LTS (GNU\/Linux 3.13.0-61-generic x86_64)<\/pre>\n<h4>2b. Find COMPUTE interfaces<\/h4>\n<pre>cmpt001:~# cat \/etc\/contrail\/<span class=\"skimlinks-unlinked\">contrail-vrouter-agent.conf<\/span> | grep -A13 -i virtual-host-interface\n [VIRTUAL-HOST-INTERFACE]\n # Everything in this section is mandatory\n\n# name of virtual host interface\n name=vhost0\n\n# IP address and prefix in ip\/prefix_len format\n ip=172.20.0.23\/32\n\n# Gateway IP address for virtual host\n gateway=172.20.0.1\n\n# Physical interface name to which virtual host interface maps to\n physical_interface=p1p1\n\ncmpt001:~# ifconfig vhost0\n vhost0 Link encap:Ethernet HWaddr b0:ob:ab:ba:0a:a0\n inet addr:172.20.0.23 Bcast:172.20.0.31 Mask:255.255.255.240\n UP BROADCAST RUNNING MULTICAST MTU:9000 Metric:1\n RX packets:84487487 errors:0 dropped:182627 overruns:0 frame:0\n TX packets:82063519 errors:0 dropped:0 overruns:0 carrier:0\n collisions:0 txqueuelen:1000\n RX bytes:253984497954 (253.9 GB) TX bytes:67502412941 (67.5 GB)\n\ncmpt001:~# ifconfig p1p1\n p1p1 Link encap:Ethernet HWaddr b0:ob:ab:ba:0a:a0\n UP BROADCAST RUNNING MULTICAST MTU:9000 Metric:1\n RX packets:194126327 errors:0 dropped:0 overruns:0 frame:0\n TX packets:125130748 errors:0 dropped:0 overruns:0 carrier:0\n collisions:0 txqueuelen:1000\n RX bytes:286638778868 (286.6 GB) TX bytes:94956347917 (94.9 GB)\n Interrupt:40 Memory:f3000000-f37fffff<\/pre>\n<h4>2c. Verify vRouter is exchanging XMPP information with the CONTRAIL CONTROLLER(s)<\/h4>\n<pre>cmpt001:~# tcpdump -D | grep -i vhost0\n 1.vhost0\n\ncmpt001:~# tcpdump -nei 1 port xmpp-server\n tcpdump: verbose output suppressed, use -v or -vv for full protocol decode\n listening on vhost0, link-type EN10MB (Ethernet), capture size 65535 bytes\n 12:04:23.420090 c9:36:dd:24:po:p0 &gt; b0:ob:ab:ba:0a:a0, ethertype IPv4 (0x0800), length 66: 172.20.0.5.5269 &gt; 172.20.0.23.58699: Flags [.], ack 3731677826, win 8748, options [nop,nop,TS val 1268013680 ecr 1267113680], length 0\n 12:04:23.420120 b0:ob:ab:ba:0a:a0 &gt; c9:36:dd:24:po:p0, ethertype IPv4 (0x0800), length 66: 172.20.0.23.58699 &gt; 172.20.0.5.5269: Flags [.], ack 1, win 6792, options [nop,nop,TS val 1267114931 ecr 1268012429], length 0\n ^C\n 2 packets captured\n 4 packets received by filter\n 0 packets dropped by kernel<\/pre>\n<h4>2d. Verify ICMP packets from example (12.12.0.102 =&gt; 10.10.0.100) is making it into the COMPUTE cmpt001<\/h4>\n<pre>cmpt001:~# tcpdump -D | grep p1p1\n 7.p1p1\n\ncmpt001:~# tcpdump -nei 7 proto 47 | grep 11.11.0.60\n tcpdump: WARNING: bond0.2004: no IPv4 address assigned\n tcpdump: verbose output suppressed, use -v or -vv for full protocol decode\n listening on bond0.2004, link-type EN10MB (Ethernet), capture size 65535 bytes\n 12:07:02.093007 00:1d:c2:8f:22:db &gt; 0a:36:cc:61:aa:l0, ethertype IPv4 (0x0800), length 126: 172.20.0.25 &gt; 172.20.0.23: GREv0, proto MPLS unicast (0x8847), length 92: MPLS (label 31, exp 0, [S], ttl 255) 12.12.0.102 &gt; 10.10.0.100: ICMP echo request, id 15119, seq 20030, length 64\n 12:07:03.094702 00:1d:c2:8f:22:db &gt; 0a:36:cc:61:aa:l0, ethertype IPv4 (0x0800), length 126: 172.20.0.25 &gt; 172.20.0.23: GREv0, proto MPLS unicast (0x8847), length 92: MPLS (label 31, exp 0, [S], ttl 255) 12.12.0.102 &gt; 10.10.0.100: ICMP echo request, id 15119, seq 20031, length 64\n ^C\n 2 packets captured\n 4 packets received by filter\n 0 packets dropped by kernel<\/pre>\n<div>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div><mark>We see that ICMP is making it into the Compute in the above TCPDUMP output. (TCPDUMP can process PROTO 47 for MPLSoGRE but if the tunnels are MPLSoUDP, you\u2019ll have to decode this in another packet analyzer like WireShark).<\/mark><\/div>\n<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<\/div>\n<p><a href=\"#Overview\">TOP<\/a><\/p>\n<hr \/>\n<h3 id=\"TOI_Step_3\">STEP 3: Trace the flow into vFW Service Instance VM<\/h3>\n<h4>3a. Find NEXT-HOP (mpls \u2013dump will output the entire Label =&gt; NextHop table) \u2013 we found the MPLS Label 31 from the Next-Hop from the SDNGW<\/h4>\n<pre>cmpt001:~# mpls --get <span style=\"color: #ff0000;\"><em><strong>31<\/strong><\/em><\/span>\n MPLS Input Label Map\n\nLabel NextHop\n -------------------\n 31 <span style=\"color: #ff0000;\"><em><strong>49<\/strong><\/em><\/span><\/pre>\n<h4>3b. Find NEXT-HOP Interface and VRF that the FW VM interface that is created on for this flow on VN_A.<\/h4>\n<pre>cmpt001:~# nh --get <span style=\"color: #ff0000;\"><em><strong>49<\/strong><\/em><\/span>\n Id:49 Type:Encap Fmly: AF_INET Rid:0 Ref_cnt:8 Vrf:11\n Flags:Valid, Policy,\n EncapFmly:0806 Oif:<span style=\"color: #ff0000;\"><em><strong>24 <\/strong><\/em><\/span>Len:14\n Encap Data: 02 95 3d 1d c9 69 00 00 5e 00 01 00 08 00\n\ncmpt001:~# vif --get <span style=\"color: #ff0000;\"><em><strong>24<\/strong><\/em><\/span>\n Vrouter Interface Table\n\nFlags: P=Policy, X=Cross Connect, S=Service Chain, Mr=Receive Mirror\n Mt=Transmit Mirror, Tc=Transmit Checksum Offload, L3=Layer 3, L2=Layer 2\n D=DHCP, Vp=Vhost Physical, Pr=Promiscuous, Vnt=Native Vlan Tagged\n Mnp=No MAC Proxy, Dpdk=DPDK PMD Interface, Rfl=Receive Filtering Offload, Mon=Interface is Monitored\n Uuf=Unknown Unicast Flood, Vof=VLAN insert\/strip offload\n\nvif0\/24 OS: <span style=\"color: #ff0000;\"><em><strong>tap93d2dja8-22<\/strong><\/em><\/span>\n Type:Virtual HWaddr:bk:2a:n6:00:02:00 IPaddr:0\n Vrf:11 Flags:PL3L2D MTU:9160 Ref:6\n RX packets:728634 bytes:71113479 errors:0\n TX packets:756736 bytes:89113687 errors:0<\/pre>\n<h4>3c. [IGNORE FOR NOW] On Vrf:11 (VN_A), we see the routing-table point to the FW\u2019s \u201cRIGHT\u201d interface as the NEXT-HOP to 10.10.0.0\/24 Network (VN_B)<\/h4>\n<pre>cmpt001:~# rt --dump 11 | grep 10.10.0\n Vrouter inet4 routing table 0\/13\/unicast\n Flags: L=Label Valid, P=Proxy ARP, T=Trap ARP, F=Flood ARP\n\nDestination PPL Flags Label Nexthop Stitched MAC(Index)\n 10.10.0.0\/24 24 P - 164 -\n\ncmpt001:~# nh --get 164\n Id:164 Type:Composite Fmly: AF_INET Rid:0 Ref_cnt:2 Vrf:11\n Flags:Valid, Policy, Ecmp,\n Sub NH(label): 95(31) -1 14(62)\n\nroot@cmpt001:~# nh --get 95\n Id:95 Type:Encap Fmly: AF_INET Rid:0 Ref_cnt:25 Vrf:11\n Flags:Valid,\n EncapFmly:0806 Oif:24 Len:14\n Encap Data: 02 95 3d 1d c9 69 00 00 5e 00 01 00 08 00\n\ncmpt001:~# vif --get 24\n Vrouter Interface Table\n\nFlags: P=Policy, X=Cross Connect, S=Service Chain, Mr=Receive Mirror\n Mt=Transmit Mirror, Tc=Transmit Checksum Offload, L3=Layer 3, L2=Layer 2\n D=DHCP, Vp=Vhost Physical, Pr=Promiscuous, Vnt=Native Vlan Tagged\n Mnp=No MAC Proxy, Dpdk=DPDK PMD Interface, Rfl=Receive Filtering Offload, Mon=Interface is Monitored\n Uuf=Unknown Unicast Flood, Vof=VLAN insert\/strip offload\n\nvif0\/24 OS: tap93d2dja8-22\n Type:Virtual HWaddr:bk:2a:n6:00:02:00 IPaddr:0\n Vrf:11 Flags:PL3L2D MTU:9160 Ref:6\n RX packets:733959 bytes:71635018 errors:0\n TX packets:762144 bytes:89646655 errors:0\n\ncmpt001:~# cat \/var\/lib\/nova\/instances\/a1b2c3d4e5f6g-7h8i-9j0k-1l2m3n4o5p6q\/<span class=\"skimlinks-unlinked\">libvirt.xml<\/span> | grep -i tap\n &lt;target dev=\"tapc218da9d-32\"\/&gt;\n &lt;target dev=\"tap13a2d42c-5d\"\/&gt;\n &lt;target dev=\"tap93d2dja8-22\"\/&gt;\n &lt;target dev=\"tapa8d2gf3a-k4\"\/&gt;<\/pre>\n<p>(Interfaces are enumerated in the order MGMT, LEFT, RIGHT, OTHER\u2026 so the TAP interface above it the \u201cRIGHT\u201d interface in VN_A)<\/p>\n<h4>3d. Check for \u201cDiscards\u201d on Vrf:11<\/h4>\n<pre>cmpt001:~# watch vrfstats --get 11\n\nEvery 2.0s: vrfstats --get 11 Fri Jun 03 19:13:13 2016\n\nVrf: 11\n<span style=\"color: #ff0000;\"><em><strong> Discards 0<\/strong><\/em><\/span>, Resolves 0, Receives 0, L2 Receives 7783, Vrf Translates 0, Unknown Unicast Floods 0\n Ecmp Composites 0, L2 Mcast Composites 26818, Fabric Composites 24593, Encap Composites 24593, Evpn Composites 0\n Udp Tunnels 0, Udp Mpls Tunnels 4000360, Gre Mpls Tunnels 7780, Vxlan Tunnels 0\n L2 Encaps 3321946, Encaps 32480\n GROs 2662900, Diags 0\n Arp Virtual Proxys 654, Arp Virtual Stitchs 1539, Arp Virtual Floods 600, Arp Physical Stitchs 0, Arp Tor Proxys 0, Arp Physical Flo\n ods 0<\/pre>\n<p>Based on the above output, it does not appear that there are any discards on Vrf:11 that would be causing the connectivity failure (Counter at \u201c0\u201d and not incrementing).<\/p>\n<h4>3e. Look for \u201cDiscards\u201d via dropstats and check relevant counters (\u201cFlow Action Drop\u201d &amp; \u201cDiscards\u201d in this case) to see if they increment<\/h4>\n<pre>cmpt001:~# watch dropstats\n\nEvery 2.0s: dropstats Fri Jun 03 19:16:59 2016\n\nGARP 0\n ARP no where to go 0\n Invalid ARPs 0\n\nInvalid IF 0\n Trap No IF 0\n IF TX Discard 0\n IF Drop 0\n IF RX Discard 0\n\nFlow Unusable 0\n Flow No Memory 0\n Flow Table Full 0\n Flow NAT no rflow 0\n<span style=\"color: #ff0000;\"><em><strong> Flow Action Drop 12040<\/strong><\/em><\/span>\n Flow Action Invalid 0\n Flow Invalid Protocol 0\n Flow Queue Limit Exceeded 132\n\n<span style=\"color: #ff0000;\"><em><strong>Discards 8372<\/strong><\/em><\/span>\n TTL Exceeded 0\n Mcast Clone Fail 0\n Cloned Original 348762341\n\nInvalid NH 20637113\n Invalid Label 0\n Invalid Protocol 0\n Rewrite Fail 0\n Invalid Mcast Source 0\n\nPush Fails 0\n Pull Fails 0\n Duplicated 0\n Head Alloc Fails 0\n Head Space Reserve Fails 0\n PCOW fails 0\n Invalid Packets 0\n\nMisc 764\n Nowhere to go 0\n Checksum errors 0\n No Fmd 0\n Invalid VNID 0\n Fragment errors 0\n Invalid Source 12\n Jumbo Mcast Pkt with DF Bit 0\n ARP No Route 0\n ARP Reply No Route 0\n No L2 Route 136423<\/pre>\n<p>\u201cDiscards\u201d and \u201cFlow Action Drop\u201d counters stayed steady at \u201c<span style=\"color: #ff0000;\"><em><strong>12040<\/strong><\/em><\/span>\u201d and \u201c<span style=\"color: #ff0000;\"><em><strong>8372<\/strong><\/em><\/span>\u201d respectively and did not increment.<\/p>\n<h4>3f. Find which VM is associated with TAP Interface tap93d2dja8-22 (there is more than one way to get this information)<\/h4>\n<p>CLI Method:<\/p>\n<p>\u2013 From previous discovery, we know that the ID of the VM VFW001 on cmpt001 is <span style=\"color: #ff0000;\"><em><strong>a1b2c3d4e5f6g-7h8i-9j0k-1l2m3n4o5p6q<\/strong><\/em><\/span>. Map the TAP Interface to the VM:<\/p>\n<pre>cmpt001:~# cat \/var\/lib\/nova\/instances\/<span style=\"color: #ff0000;\"><em><strong>a1b2c3d4e5f6g-7h8i-9j0k-1l2m3n4o5p6q<\/strong><\/em><\/span>\/<span class=\"skimlinks-unlinked\">libvirt.xml<\/span> | grep -i tap\n &lt;target dev=\"tapc218da9d-32\"\/&gt;\n &lt;target dev=\"tap13a2d42c-5d\"\/&gt;\n &lt;target dev=\"<span style=\"color: #ff0000;\"><em><strong>tap93d2dja8-22<\/strong><\/em><\/span>\"\/&gt;\n &lt;target dev=\"tapa8d2gf3a-k4\"\/&gt;<\/pre>\n<p>Contrail GUI Method: Find the Compute where the VM resides (cmpt001) via Monitor =&gt; Virtual Routers = cmpt001 \/\/ Interfaces. From there, do a search for the interface tap93d2dja8-22. From there, you should be able to find which VM the TAP Interface is mapped to.<\/p>\n<h4>3g. From the above information, we know that this is mapped to the vFW\u201dRIGHT\u201d interface which is on the VN_A Network. We can do a TCPDUMP to verify if the traffic is making it to the FW\u2019s Ingress\/VN_A interface:<\/h4>\n<pre>cmpt001:~# tcpdump -nei tap93d2dja8-22\n tcpdump: WARNING: tap93d2dja8-22: no IPv4 address assigned\n tcpdump: verbose output suppressed, use -v or -vv for full protocol decode\n listening on tap93d2dja8-22, link-type EN10MB (Ethernet), capture size 65535 bytes\n 12:09:41.995714 bk:2a:n6:00:02:00 &gt; 02:95:3d:1d:c9:69, ethertype IPv4 (0x0800), length 74: 12.12.0.102 &gt; 10.10.0.100: ICMP echo request, id 61, seq 10575, length 40\n 12:09:42.995769 bk:2a:n6:00:02:00 &gt; 02:95:3d:1d:c9:69, ethertype IPv4 (0x0800), length 74: 12.12.0.102 &gt; 10.10.0.100: ICMP echo request, id 61, seq 10593, length 40\n^C\n2\u00a0packets captured\n4\u00a0packets received by filter\n 0 packets dropped by kernel<\/pre>\n<h4>3h. From the above, we see ICMP echo requests going into the FW, but no replies. Let\u2019s check for what the vFW\u00a0sees:<\/h4>\n<pre>toolsvm:~$ ssh 192.168.0.194\n\nPassword:\n --- JUNOS 15.1X49-D30.3 built 2015-12-17 04:39:24 UTC\n VFW001&gt;\n\nVFW001&gt; show security flow session destination-prefix 10.10.0.100\n Session ID: 206346, Policy name: allow_restricted\/6, Timeout: 2, Valid\n In: 12.12.0.102\/34054 --&gt; 10.10.0.100\/61;icmp, If: ge-0\/0\/1.0, Pkts: 1, Bytes: 60,\n Out: 10.10.0.100\/61 --&gt; 12.12.0.102\/34054;icmp, If: ge-0\/0\/0.0, Pkts: 1, Bytes: 0,\n\nSession ID: 206347, Policy name: allow_restricted\/6, Timeout: 4, Valid\n In: 12.12.0.102\/34058 --&gt; 10.10.0.100\/61;icmp, If: ge-0\/0\/1.0, Pkts: 1, Bytes: 60,\n Out: 10.10.0.100\/61 --&gt; 12.12.0.102\/34058;icmp, If: ge-0\/0\/0.0, Pkts: 1, Bytes: 0,\n\nSession ID: 206350, Policy name: allow_restricted\/6, Timeout: 2, Valid\n In: 12.12.0.102\/34057 --&gt; 10.10.0.100\/61;icmp, If: ge-0\/0\/1.0, Pkts: 1, Bytes: 60,\n Out: 10.10.0.100\/61 --&gt; 12.12.0.102\/34057;icmp, If: ge-0\/0\/0.0, Pkts: 1, Bytes: 0,\n Total sessions: 3<\/pre>\n<p>The vFW\u00a0sees packets inbound through it to the VM 10.10.0.100 but no return traffic (which matches what we see on the TCPDUMP on the FW\u2019s GE-0\/0\/1 or \u201cRIGHT\u201d interface). At this point, we need to look at the traffic leaving the FW on the \u201cLEFT\u201d\/VN_B interface.<\/p>\n<h4>3i. Check the COMPUTE vRouter Flow Table to see if the traffic is being forwarded.<\/h4>\n<pre>cmpt001:~# flow --match 10.10.0.100\n Flow table(size 68157440, entries 542386)\n\nEntries: Created 898146 Added 898144 Processed 898146 Used Overflow entries 0\n (Created Flows\/CPU: 368496 140472 62462 39956 28374 22527 25634 19742 20169 15999 6767 6693 6514 6322 7041 6249 6200 6272 6324 6235 7985 9035 7329 9146 6741 6608 5981 7374 10025 8246 663 941 721 734 700 671 771 837 1120 4070)(oflows 0)\n\nAction:F=Forward, D=Drop N=NAT(S=SNAT, D=DNAT, Ps=SPAT, Pd=DPAT, L=Link Local Port)\n Other:K(nh)=Key_Nexthop, S(nh)=RPF_Nexthop\n Flags:E=Evicted, Ec=Evict Candidate, N=New Flow, M=Modified\n TCP(r=reverse):S=SYN, F=FIN, R=RST, C=HalfClose, E=Established, D=Dead\n\nListing flows matching ([10.10.0.100]:*)\n\nIndex Source:Port\/Destination:Port Proto(V)\n -----------------------------------------------------------------------------------\n\n168624&lt;=&gt;23140 12.12.0.102:1393 1 (2-&gt;3)\n 10.10.0.100:0\n (Gen: 5, K(nh):33, Action:F, Flags:, S(nh):94, Stats:257760\/25260480, SPort 53824)\n --\n 430164&lt;=&gt;119628 12.12.0.102:1393 1 (13-&gt;5)\n 10.10.0.100:0\n (Gen: 11, K(nh):49, Action:F, Flags:, S(nh):88, Stats:257760\/21651840, SPort 60610)\n --<\/pre>\n<p><a href=\"#Overview\">TOP<\/a><\/p>\n<hr \/>\n<h3 id=\"TOI_Step_4\">STEP 4: Verify traffic is leaving vFW Service Instance VM towards 10.10.0.100<\/h3>\n<p><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/07\/28163632680_7f52eebbe3_b.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-full wp-image-7142\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/07\/28163632680_7f52eebbe3_b.jpg\" alt=\"28163632680_7f52eebbe3_b\" width=\"674\" height=\"731\" data-id=\"7142\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<h4>4a. Verify next TAP Interface for FW (\u201cLEFT\u201d \/ VN_B) sees traffic exit the vFW\u00a0destined for the VM at 10.10.0.100<\/h4>\n<pre>cmpt001:~# nh --get 33\n Id:93 Type:Encap Fmly: AF_INET Rid:0 Ref_cnt:5 Vrf:12\n Flags:Valid, Policy,\n EncapFmly:0806 Oif:12 Len:14\n Encap Data: 02 31 e6 d2 4c 7d 00 00 5e 00 01 00 08 00\n\ncmpt001:~# vif --get 12\n Vrouter Interface Table\n\nFlags: P=Policy, X=Cross Connect, S=Service Chain, Mr=Receive Mirror\n Mt=Transmit Mirror, Tc=Transmit Checksum Offload, L3=Layer 3, L2=Layer 2\n D=DHCP, Vp=Vhost Physical, Pr=Promiscuous, Vnt=Native Vlan Tagged\n Mnp=No MAC Proxy, Dpdk=DPDK PMD Interface, Rfl=Receive Filtering Offload, Mon=Interface is Monitored\n Uuf=Unknown Unicast Flood, Vof=VLAN insert\/strip offload\n\nvif0\/12 OS: tap13a2d42c-5d\n Type:Virtual HWaddr:bk:2a:n6:00:02:00 IPaddr:0\n Vrf:12 Flags:PL3L2D MTU:9160 Ref:6\n RX packets:1236404 bytes:135113415 errors:0\n TX packets:1231952 bytes:120251878 errors:0\n\ncmpt001:~# cat \/var\/lib\/nova\/instances\/a1b2c3d4e5f6g-7h8i-9j0k-1l2m3n4o5p6q\/<span class=\"skimlinks-unlinked\">libvirt.xml<\/span> | grep -i tap\n &lt;target dev=\"tapc218da9d-32\"\/&gt;\n &lt;target dev=\"tap13a2d42c-5d\"\/&gt;\n &lt;target dev=\"tap93d2dja8-22\"\/&gt;\n &lt;target dev=\"tapa8d2gf3a-k4\"\/&gt;\n\ncmpt001:~# tcpdump -nei tap13a2d42c-5d\n tcpdump: WARNING: tap13a2d42c-5d: no IPv4 address assigned\n tcpdump: verbose output suppressed, use -v or -vv for full protocol decode\n listening on tap13a2d42c-5d, link-type EN10MB (Ethernet), capture size 65535 bytes\n 12:24:31.175890 02:dd:26:2b:24:p2 &gt; 7b:23:a9:tu:c3:p0, ethertype IPv4 (0x0800), length 74: 12.12.0.102 &gt; 10.10.0.100: ICMP echo request, id 61, seq 11410, length 40\n 12:24:32.176227 02:dd:26:2b:24:p2 &gt; 7b:23:a9:tu:c3:p0, ethertype IPv4 (0x0800), length 74: 12.12.0.102 &gt; 10.10.0.100: ICMP echo request, id 61, seq 11413, length 40\n ^C\n 2 packets captured\n 4 packets received by filter\n 0 packets dropped by kernel<\/pre>\n<h4>4b. Traffic (ICMP echo requests) is leaving vFW\u00a0egress interface (GE-0\/0\/0) \u201cLEFT\u201d or VN_B interface destined towards the VM 10.10.0.100. Check to see if there are any discards on the VRF.<\/h4>\n<pre>cmpt001:~# watch vrfstats --get 12\n\nEvery 2.0s: vrfstats --get 12 Fri Jun 03 19:13:13 2016\n\nVrf: 12\n<span style=\"color: #ff0000;\"><em><strong> Discards 0<\/strong><\/em><\/span>, Resolves 0, Receives 0, L2 Receives 12369, Vrf Translates 0, Unknown Unicast Floods 0\n Ecmp Composites 0, L2 Mcast Composites 18742, Fabric Composites 12190, Encap Composites 12168, Evpn Composites 0\n Udp Tunnels 0, Udp Mpls Tunnels 17, Gre Mpls Tunnels 4010, Vxlan Tunnels 0\n L2 Encaps 71982, Encaps 1302371\n GROs 2687, Diags 0\n Arp Virtual Proxys 8658, Arp Virtual Stitchs 4858, Arp Virtual Floods 3748, Arp Physical Stitchs 0, Arp Tor Proxys 0, Arp Physical Floods 30<\/pre>\n<p>No discards.<\/p>\n<h4>4c. Verify routing on Vrf:10 (VN_B) FIB table for 10.10.0.100<\/h4>\n<pre>cmpt001:~# rt --dump 12 | grep 10.10.0.100\n Vrouter inet4 routing table 0\/2\/unicast\n Flags: L=Label Valid, P=Proxy ARP, T=Trap ARP, F=Flood ARP\n\nDestination PPL Flags Label Nexthop Stitched MAC(Index)\n 10.10.0.100\/32 32 LP 31 <span style=\"color: #ff0000;\"><em><strong>88 <\/strong><\/em><\/span>2:38:c8:ea:9a:21(211664)<\/pre>\n<h4>4d. Find the NEXT-HOP COMPUTE to get to the VM on VN_B at 10.10.0.100<\/h4>\n<pre>cmpt001:~# nh --get 88\n Id:88 Type:Tunnel Fmly: AF_INET Rid:0 Ref_cnt:144 Vrf:0\n Flags:Valid, MPLSoUDP,\n Oif:0 Len:14 Flags Valid, MPLSoUDP, Data:8c dc d4 10 74 c0 8c dc d4 10 75 a0 08 00\n Vrf:0 Sip:172.20.0.23 Dip:172.20.0.24<\/pre>\n<p>Next-Hop 88 points to a destination IP of 172.20.0.24 (vhost0 Interface IP of the destination Compute on Default Vrf0) with MPLS Label 31<\/p>\n<p><a href=\"#Overview\">TOP<\/a><\/p>\n<hr \/>\n<h3 id=\"TOI_Step_5\">STEP 5: Verify traffic is getting to Destination VM at 10.10.0.100 on TAP Interface<\/h3>\n<h4>5a. Find NEXT-HOP COMPUTE at 172.29.2.82<\/h4>\n<p>CLI Method (From toolsvm \u2013 use the IP of the Destination VM to find Compute):<\/p>\n<pre>toolsvm:~$ for x in $(nova list | grep -i 10.10.0.100 | awk {'print $4'}); do nova show $x | sed -n '7p;21p;25p' | awk {'print $4'}; done\n<span style=\"color: #ff0000;\"><em><strong> cmpt002<\/strong><\/em>\n<em><strong> 98asdfhjkn213-sdai-ncxv-3421987kjlsm<\/strong><\/em>\n<em><strong> testvm-VN_B_1<\/strong><\/em><\/span>\n\ntoolsvm:~$ nova show 98asdfhjkn213-sdai-ncxv-3421987kjlsm\n +------------------------------------------+-------------------------------------------------------------+\n | Property | Value |\n +------------------------------------------+-------------------------------------------------------------+\n | MNS_shared_OAM_PROTECTED_NET_1_1 network | 10.10.0.100 |\n | OS-DCF:diskConfig | AUTO |\n | OS-EXT-AZ:availability_zone | nova |\n | OS-EXT-SRV-ATTR:host | <span style=\"color: #ff0000;\"><em><strong>cmpt002<\/strong> <\/em><\/span>|\n | OS-EXT-SRV-ATTR:hypervisor_hostname | cmpt002.<span class=\"skimlinks-unlinked\">test.net<\/span> |\n | OS-EXT-SRV-ATTR:instance_name | instance-00000f28 |\n | OS-EXT-STS:power_state | 1 |\n | OS-EXT-STS:task_state | - |\n | OS-EXT-STS:vm_state | active |\n | OS-SRV-USG:launched_at | 2016-06-01T00:35:36.000000 |\n | OS-SRV-USG:terminated_at | - |\n | accessIPv4 | |\n | accessIPv6 | |\n | config_drive | |\n | created | 2016-06-01T00:35:36Z |\n | flavor | m1.tiny (2) |\n | hostId | a0s9dfuwqehrlkqwerl89ydfkj1394874329y2nlkadfasygas98ydfs |\n | id | <span style=\"color: #ff0000;\"><em><strong>98asdfhjkn213-sdai-ncxv-3421987kjlsm<\/strong><\/em><\/span> |\n | image | ubuntu-14 (1f062a45-4a90-437d-a2b8-b2b5a565d95a) |\n | key_name | - |\n | metadata | {} |\n | name | testvm-VN_B_1 |\n | os-extended-volumes:volumes_attached | [] |\n | progress | 0 |\n | security_groups | default |\n | status | ACTIVE |\n | tenant_id | 9asdf2983riahdf9987sdf9ya9sya9sy |\n | updated | 2016-06-01T00:35:36Z |\n | user_id | d8923923hisuadfhf893923h2hfdasfh |\n +------------------------------------------+-------------------------------------------------------------+<\/pre>\n<p>GUI Method (From Contrail GUI)<\/p>\n<p>Monitor =&gt; Infrastructure =&gt; Virtual Routers =&gt; Search<\/p>\n<h4>5b. Go to COMPUTE <em><strong>cmpt002<\/strong><\/em>. Based on Label <em><strong>31 <\/strong><\/em>for NEXT-HOP on this COMPUTE, we can find where the traffic is destined to.<\/h4>\n<pre>cmpt002:~# mpls --get <span style=\"color: #ff0000;\"><em><strong>31<\/strong><\/em><\/span>\n MPLS Input Label Map\n\nLabel NextHop\n -------------------\n 31 <span style=\"color: #ff0000;\"><em><strong>73<\/strong><\/em><\/span>\n root@cmpt002:~# nh --get <span style=\"color: #ff0000;\"><em><strong>73<\/strong><\/em><\/span>\n Id:73 Type:Encap Fmly: AF_INET Rid:0 Ref_cnt:6 Vrf:13\n Flags:Valid, Policy,\n EncapFmly:0806 Oif:<span style=\"color: #ff0000;\"><em><strong>14 <\/strong><\/em><\/span>Len:14\n Encap Data: 02 38 c8 ea 9a 21 00 00 5e 00 01 00 08 00\n\ncmpt002:~# vif --get <span style=\"color: #ff0000;\"><em><strong>14<\/strong><\/em><\/span>\n Vrouter Interface Table\n\nFlags: P=Policy, X=Cross Connect, S=Service Chain, Mr=Receive Mirror\n Mt=Transmit Mirror, Tc=Transmit Checksum Offload, L3=Layer 3, L2=Layer 2\n D=DHCP, Vp=Vhost Physical, Pr=Promiscuous, Vnt=Native Vlan Tagged\n Mnp=No MAC Proxy, Dpdk=DPDK PMD Interface, Rfl=Receive Filtering Offload, Mon=Interface is Monitored\n Uuf=Unknown Unicast Flood, Vof=VLAN insert\/strip offload\n\nvif0\/14 OS: <span style=\"color: #ff0000;\"><em><strong>tap83f2ki4w-72<\/strong><\/em><\/span>\n Type:Virtual HWaddr:bk:2a:n6:00:02:00 IPaddr:0\n Vrf:13 Flags:PL3L2D MTU:9160 Ref:6\n RX packets:2272968 bytes:214007093 errors:0\n TX packets:2294863 bytes:287437540 errors:0<\/pre>\n<h4>5c. Verify the above output matches the VM libvert.xml<\/h4>\n<pre>cmpt002:~# cat \/var\/lib\/nova\/instances\/<strong><span style=\"color: #ff0000;\">9<em>8asdfhjkn213-sdai-ncxv-3421987kjlsm<\/em><\/span><\/strong>\/<span class=\"skimlinks-unlinked\">libvirt.xml<\/span> | grep -i tap83f2ki4w-72\n &lt;target dev=\"<span style=\"color: #ff0000;\"><em><strong>tap83f2ki4w-72<\/strong><\/em><\/span>\"\/&gt;<\/pre>\n<h4>5d. Check for Vrf:13 discards<\/h4>\n<pre>cmpt002:~# watch vrfstats --get 13\n\nEvery 2.0s: vrfstats --get 13 Fri Jun 03 19:33:33 2016\n\nVrf: 13\n<span style=\"color: #ff0000;\"><em><strong> Discards 0<\/strong><\/em><\/span>, Resolves 0, Receives 0, L2 Receives 3299, Vrf Translates 0, Unknown Unicast Floods 0\n Ecmp Composites 0, L2 Mcast Composites 3364, Fabric Composites 330, Encap Composites 739, Evpn Composites 0\n Udp Tunnels 0, Udp Mpls Tunnels 4, Gre Mpls Tunnels 0, Vxlan Tunnels 0\n L2 Encaps 3338, Encaps 2421364\n GROs 40513, Diags 0\n Arp Virtual Proxys 2906, Arp Virtual Stitchs 0, Arp Virtual Floods 0, Arp Physical Stitchs 0, Arp Tor Proxys 0, Arp Physical Floods 0<\/pre>\n<h4>5e. Check vRouter Flow Table for \u201cAction:F\u201d<\/h4>\n<pre>cmpt002:~# flow --match 10.10.0.100\n Flow table(size 68157440, entries 532480)\n\nEntries: Created 2101736 Added 2100485 Processed 2101736 Used Overflow entries 0\n (Created Flows\/CPU: 367906 175642 111664 82241 69167 55275 51234 46499 43885 43268 16593 19378 19266 18389 18108 17846 17739 18159 17939 18510 31225 119065 99542 54060 37515 32004 30342 31058 41341 28021 7123 86430 156010 50283 20184 11714 9180 8086 7844 12001)(oflows 0)\n\nAction:F=Forward, D=Drop N=NAT(S=SNAT, D=DNAT, Ps=SPAT, Pd=DPAT, L=Link Local Port)\n Other:K(nh)=Key_Nexthop, S(nh)=RPF_Nexthop\n Flags:E=Evicted, Ec=Evict Candidate, N=New Flow, M=Modified\n TCP(r=reverse):S=SYN, F=FIN, R=RST, C=HalfClose, E=Established, D=Dead\n\nListing flows matching ([10.10.0.100]:*)\n\nIndex Source:Port\/Destination:Port Proto(V)\n -----------------------------------------------------------------------------------\n 14325&lt;=&gt;438965 12.12.0.102:61 1 (6-&gt;5)\n 10.10.0.100:0\n (Gen: 10, K(nh):73, <span style=\"color: #ff0000;\"><em><strong>Action:F<\/strong><\/em><\/span>, Flags:, S(nh):22, Stats:1166\/69960, SPort 61800)\n --<\/pre>\n<h4>5f. Verify Traffic is being forwarded on TAP Interface on the VM<\/h4>\n<pre>cmpt002:~# tcpdump -nei tap83f2ki4w-72\n tcpdump: WARNING: tap83f2ki4w-72: no IPv4 address assigned\n tcpdump: verbose output suppressed, use -v or -vv for full protocol decode\n listening on tap83f2ki4w-72, link-type EN10MB (Ethernet), capture size 65535 bytes\n 13:02:32.939608 bk:2a:n6:00:02:00 &gt; 7b:23:a9:tu:c3:p0, ethertype IPv4 (0x0800), length 74: 12.12.0.102 &gt; 10.10.0.100: ICMP echo request, id 64, seq 59313, length 40\n 13:02:33.935583 bk:2a:n6:00:02:00 &gt; 7b:23:a9:tu:c3:p0, ethertype IPv4 (0x0800), length 74: 12.12.0.102 &gt; 10.10.0.100: ICMP echo request, id 64, seq 59317, length 40\n 13:02:34.952637 bk:2a:n6:00:02:00 &gt; 7b:23:a9:tu:c3:p0, ethertype IPv4 (0x0800), length 74: 12.12.0.102 &gt; 10.10.0.100: ICMP echo request, id 64, seq 59321, length 40\n 13:02:35.960168 bk:2a:n6:00:02:00 &gt; 7b:23:a9:tu:c3:p0, ethertype IPv4 (0x0800), length 74: 12.12.0.102 &gt; 10.10.0.100: ICMP echo request, id 64, seq 59322, length 40\n ^C\n 4 packets captured\n 6 packets received by filter\n 0 packets dropped by kernel<\/pre>\n<p>The traffic flow packets are making it all the to the TAP Interface on the vRouter of the Compute that is assigned to the VM 10.10.0.100. We need to get the DST VM owner to verify that they can see the traffic and at this point it could be any number of problems:<br \/>\n\u2013 VM Host Routing Table<br \/>\n\u2013 VM IPTables or similar service filtering inbound\/outbound traffic<br \/>\n\u2013 OpenStack Security Group applied to VM<br \/>\n\u2013 Controller\/Compute Routing Issue<br \/>\n\u2013 Etc.,<\/p>\n<p><a href=\"#Overview\">TOP<\/a><\/p>\n<hr \/>\n<h3 id=\"TOI_Step_6\">STEP 6: On VM, run TCPDUMP to inspect inbound traffic<\/h3>\n<h4>6a. Access VM (this example will utilize Link-Local Address from Compute)<br \/>\nFind Link-Local Address of TAP interface of VM via Contrail Web GUI<\/h4>\n<p>On Compute, SSH to Link-Local Address 169.254.0.14<\/p>\n<pre>cmpt002:\/etc# ssh 169.254.0.14\n 169.254.0.14's password:\n Welcome to Ubuntu 14.04.1 LTS (GNU\/Linux 3.13.0-32-generic x86_64)\n\ntestvm-vn_b:~$<\/pre>\n<h4>6b. Verify Traffic is making it to the VM<\/h4>\n<pre>testvm-vn_b:~$ ifconfig\n eth0 Link encap:Ethernet HWaddr 7b:23:a9:tu:c3:p0\n inet addr:10.10.0.100 Bcast:172.20.50.255 Mask:255.255.255.0\n UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1\n RX packets:2298122 errors:0 dropped:0 overruns:0 frame:0\n TX packets:2276178 errors:0 dropped:0 overruns:0 carrier:0\n collisions:0 txqueuelen:1000\n RX bytes:287697225 (287.6 MB) TX bytes:214259840 (214.2 MB)\n\neth1 Link encap:Ethernet HWaddr 02:8a:db:64:fb:45\n inet addr:192.168.0.58 Bcast:192.168.0.255 Mask:255.255.255.0\n UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1\n RX packets:2298122 errors:0 dropped:0 overruns:0 frame:0\n TX packets:2276178 errors:0 dropped:0 overruns:0 carrier:0\n collisions:0 txqueuelen:1000\n RX bytes:287697225 (287.6 MB) TX bytes:214259840 (214.2 MB)\n\nlo Link encap:Local Loopback\n inet addr:127.0.0.1 Mask:255.0.0.0\n UP LOOPBACK RUNNING MTU:65536 Metric:1\n RX packets:34 errors:0 dropped:0 overruns:0 frame:0\n TX packets:34 errors:0 dropped:0 overruns:0 carrier:0\n collisions:0 txqueuelen:0\n RX bytes:7130 (7.1 KB) TX bytes:7130 (7.1 KB)\n\ntestvm-vn_b:~# tcpdump -D\n 1.eth0\n 2.eth1\n 3.any (Pseudo-device that captures on all interfaces)\n 4.lo\n\ntestvm-vn_b:~$ tcpdump -nei 1 proto 1\n tcpdump: verbose output suppressed, use -v or -vv for full protocol decode\n listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes\n 13:16:15.056859 bk:2a:n6:00:02:00 &gt; 7b:23:a9:tu:c3:p0, ethertype IPv4 (0x0800), length 74: 12.12.0.102 &gt; 10.10.0.100: ICMP echo request, id 65, seq 109, length 40\n 13:16:15.056963 7b:23:a9:tu:c3:p0 &gt; bk:2a:n6:00:02:00, ethertype IPv4 (0x0800), length 74: 10.10.0.100 &gt; 12.12.0.102: ICMP echo reply, id 65, seq 109, length 40\n ^C\n 2 packets captured\n 4 packets received by filter\n 0 packets dropped by kernel\n\ntestvm-vn_b:~$<\/pre>\n<div>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div><mark>At this point, we can safely say that the traffic flow packets are making it all the to the TAP Interface on the vRouter of the Compute that is assigned to the VM 10.10.0.100. There are any number of reasons why traffic may fail to\/from a VM:<\/mark><\/div>\n<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<\/div>\n<p>\u2013 VM Host Routing Table<br \/>\n\u2013 VM IPTables or similar service filtering inbound\/outbound traffic<br \/>\n\u2013 OpenStack Security Group applied to VM<br \/>\n\u2013 Controller\/Compute Routing Issue<br \/>\n\u2013 Etc.,<\/p>\n<p><a href=\"#Overview\">TOP<\/a><\/p>\n<hr \/>\n<h2 id=\"Tracing_Inside_Out\">Tracing: Inside =&gt; Out<\/h2>\n<hr \/>\n<h3 id=\"TIO_Step_1\">STEP 1: On Compute where VM is being hosted on, Trace flow back out to Source Host<\/h3>\n<p><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/07\/29831101064_328e78b9ee_b.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-full wp-image-7143\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/07\/29831101064_328e78b9ee_b.jpg\" alt=\"29831101064_328e78b9ee_b\" width=\"674\" height=\"731\" data-id=\"7143\" \/><\/a><br \/>\n&gt;&gt;*Assume traffic is fixed on the DST VM and now we are tracing the return flow back to the SRC IP<\/p>\n<h4>1a. Get vRouter Flow Table information for return traffic from 10.10.0.100 to 12.12.0.102<\/h4>\n<pre>cmpt002:~# flow --match 12.12.0.102\n Flow table(size 68157440, entries 532480)\n\nEntries: Created 2105344 Added 2104093 Processed 2105344 Used Overflow entries 0\n (Created Flows\/CPU: 368319 176011 111801 82325 69226 55341 51282 46532 43914 43306 16597 19384 19280 18394 18114 17851 17745 18169 17948 18521 31269 119556 99662 54124 37564 32051 30401 31112 41397 28061 7134 86678 156797 50372 20220 11723 9190 8099 7854 12020)(oflows 0)\n\nAction:F=Forward, D=Drop N=NAT(S=SNAT, D=DNAT, Ps=SPAT, Pd=DPAT, L=Link Local Port)\n Other:K(nh)=Key_Nexthop, S(nh)=RPF_Nexthop\n Flags:E=Evicted, Ec=Evict Candidate, N=New Flow, M=Modified\n TCP(r=reverse):S=SYN, F=FIN, R=RST, C=HalfClose, E=Established, D=Dead\n\nListing flows matching ([12.12.0.102]:*)\n\nIndex Source:Port\/Destination:Port Proto(V)\n -----------------------------------------------------------------------------------\n 463620&lt;=&gt;89580 10.10.0.100:65 1 (6-&gt;5)\n 12.12.0.102:0\n (Gen: 14, K(nh):<span style=\"color: #ff0000;\"><em><strong>73<\/strong><\/em><\/span>, Action:F, Flags:, <span style=\"color: #ff0000;\"><em><strong>E:0<\/strong><\/em><\/span>, S(nh):73, Stats:3\/222, SPort 51745)\n --<\/pre>\n<div>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div><em><mark>E:0<\/mark><\/em> == ECMP Index 0 (for ECMP Multi-Path, Next-Hop starts and increments from 0)<\/div>\n<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<\/div>\n<h4>1b. Find Return Next-Hop Information<\/h4>\n<pre>cmpt002:~# nh --get <span style=\"color: #ff0000;\"><em><strong>73<\/strong><\/em><\/span>\n Id:73 Type:Encap Fmly: AF_INET Rid:0 Ref_cnt:6 Vrf:13\n Flags:Valid, Policy,\n EncapFmly:0806 Oif:<span style=\"color: #ff0000;\"><em><strong>14<\/strong> <\/em><\/span>Len:14\n Encap Data: 02 38 c8 ea 9a 21 00 00 5e 00 01 00 08 00\n\ncmpt002:\/etc# rt --dump 13 | grep 172.20.212\n Vrouter inet4 routing table 0\/6\/unicast\n Flags: L=Label Valid, P=Proxy ARP, T=Trap ARP, F=Flood ARP\n\nDestination PPL Flags Label Nexthop Stitched MAC(Index)\n 172.20.212.0\/24 0 P - <span style=\"color: #ff0000;\"><em><strong>102<\/strong> <\/em><\/span>-\n\ncmpt002:~# nh --get 102\n Id:102 Type:Composite Fmly: AF_INET Rid:0 Ref_cnt:6601 Vrf:13\n Flags:Valid, Policy, Ecmp,\n Sub NH(label): <span style=\"color: #ff0000;\"><em><strong>22<\/strong><\/em><\/span>(27) 22(31)<\/pre>\n<div>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div><mark>Here we see 2\u00a0Next-Hops and since we saw <em>E:0<\/em> in the vRouter Flow Table, it means we will take the first Next-Hop(Label) of <em>22<\/em>(27). Remember this MPLS Label <em>22 <\/em>as we will need this to get the VHOST0 IP of the Compute where the vFW\u00a0resides on.<\/mark><\/div>\n<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<\/div>\n<pre>cmpt002:\/etc# nh --get <span style=\"color: #ff0000;\"><em><strong>22<\/strong><\/em><\/span>\n Id:22 Type:Tunnel Fmly: AF_INET Rid:0 Ref_cnt:100 Vrf:0\n Flags:Valid, MPLSoUDP,\n Oif:0 Len:14 Flags Valid, MPLSoUDP, Data:8c dc d4 10 75 a0 8c dc d4 10 74 c0 08 00\n Vrf:0 Sip:172.20.0.24 Dip:<span style=\"color: #ff0000;\"><em><strong>172.20.0.23<\/strong><\/em><\/span><\/pre>\n<div>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div><span style=\"color: #ff0000;\"><strong><em><mark>172.20.0.23<\/mark><\/em><\/strong> (<em>cmpt001<\/em>)<\/span> is the Compute where the vFW VM resides.<\/div>\n<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<\/div>\n<p><a href=\"#Overview\">TOP<\/a><\/p>\n<hr \/>\n<h3 id=\"TIO_Step_2\">STEP 2: On Compute where Next-Hop vFW VM is being hosted on, verify return flow is hitting same egress vFW as ingress<\/h3>\n<h4>2a. Trace path of return flow back (MPLS Label 27) to vFWand verify it is the same vFW\u00a0that was utilized for the inbound traffic.<\/h4>\n<p>The COMPUTE with Vhost0 IP of 172.20.0.23 == cmpt001 and VFW001 has a ID of a1b2c3d4e5f6g-7h8i-9j0k-1l2m3n4o5p6q from previous discovery.<\/p>\n<pre>cmpt001:~# mpls --get <span style=\"color: #ff0000;\"><em><strong>27<\/strong><\/em><\/span>\n MPLS Input Label Map\n\nLabel NextHop\n -------------------\n 27 <span style=\"color: #ff0000;\"><em><strong>65<\/strong><\/em><\/span>\n root@cmpt001:~# nh --get <span style=\"color: #ff0000;\"><em><strong>65<\/strong><\/em><\/span>\n Id:65 Type:Encap Fmly: AF_INET Rid:0 Ref_cnt:5 Vrf:12\n Flags:Valid, Policy,\n EncapFmly:0806 Oif:<span style=\"color: #ff0000;\"><em><strong>29<\/strong><\/em><\/span> Len:14\n Encap Data: 02 31 e6 d2 4c 7d 00 00 5e 00 01 00 08 00\n\ncmpt001:~# vif --get <span style=\"color: #ff0000;\"><em><strong>29<\/strong><\/em><\/span>\n Vrouter Interface Table\n\nFlags: P=Policy, X=Cross Connect, S=Service Chain, Mr=Receive Mirror\n Mt=Transmit Mirror, Tc=Transmit Checksum Offload, L3=Layer 3, L2=Layer 2\n D=DHCP, Vp=Vhost Physical, Pr=Promiscuous, Vnt=Native Vlan Tagged\n Mnp=No MAC Proxy, Dpdk=DPDK PMD Interface, Rfl=Receive Filtering Offload, Mon=Interface is Monitored\n Uuf=Unknown Unicast Flood, Vof=VLAN insert\/strip offload\n\nvif0\/29 OS: <span style=\"color: #ff0000;\"><em><strong>tap13a2d42c-5d<\/strong><\/em><\/span>\n Type:Virtual HWaddr:bk:2a:n6:00:02:00 IPaddr:0\n Vrf:12 Flags:PL3L2D MTU:9160 Ref:6\n RX packets:1311527 bytes:145819268 errors:0\n TX packets:1305396 bytes:125789289 errors:0\n\ncmpt001:~# cat \/var\/lib\/nova\/instances\/a1b2c3d4e5f6g-7h8i-9j0k-1l2m3n4o5p6q\/<span class=\"skimlinks-unlinked\">libvirt.xml<\/span> | grep -i tap\n &lt;target dev=\"tapc218da9d-32\"\/&gt;\n &lt;target dev=\"<span style=\"color: #ff0000;\"><em><strong>tap13a2d42c-5d<\/strong><\/em><\/span>\"\/&gt;\n &lt;target dev=\"tap93d2dja8-22\"\/&gt;\n &lt;target dev=\"tapa8d2gf3a-k4\"\/&gt;<\/pre>\n<div>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div><mark>This is the same vFWas was used for the Ingress flow so this symmetric flow is now verified. If traffic was SOURCED from VM out, then you would follow the same procedure outbound the rest of the way as we used to trace the flow inbound into the VM 10.10.0.100.<\/mark><\/div>\n<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<\/div>\n<p>Continue the same process to trace the flows outbound from the vFW to the VM.<\/p>\n<p><a href=\"#Overview\">TOP<\/a><\/p>\n<hr \/>\n<h2 id=\"References\">References<\/h2>\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div>RESOURCE<\/div>\n<\/td>\n<td>\n<div>DESCRIPTION<\/div>\n<\/td>\n<\/tr>\n<tr>\n<td><a href=\"http:\/\/www.opencontrail.org\/a-journey-of-a-packet-within-opencontrail\/\">Juniper Contrail \u2013 Life of Packet<\/a><\/td>\n<td>Life of packet Blog<\/td>\n<\/tr>\n<tr>\n<td><a href=\"https:\/\/github.com\/Juniper\/contrail-controller\/wiki\/A-guide-to-'vRouter'-command-line-utilities-(work-in-progress)\">Juniper vRouter Commands<\/a><\/td>\n<td>Juniper GitHub for vRouter CLI\u00a0Commands<\/td>\n<\/tr>\n<tr>\n<td><a href=\"https:\/\/www.juniper.net\/techpubs\/en_US\/contrail2.21\/topics\/task\/configuration\/vrouter-cli-utilities-vnc.html\">Juniper vRouter Utilities<\/a><\/td>\n<td>\n<div>Juniper TechPubs vRouter CLI Utilities<\/div>\n<\/td>\n<\/tr>\n<tr>\n<td><a href=\"http:\/\/docs.openstack.org\/cli-reference\/content\/\">OpenStack CLI Reference<\/a><\/td>\n<td>\n<div>OpenStack CLI Reference<\/div>\n<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<p><a href=\"#Overview\">TOP<\/a><\/p>\n<hr \/>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>This is a guest blog by\u00a0Johnny Chen from AT&amp;T with contributions by\u00a0Qasim Arham, Henon Huang, Vijay Kamisetty from Juniper Networks. Overview The purpose of this is to lay out a&#8230;<\/p>\n","protected":false},"author":491,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[30,31,20,12,32],"tags":[],"acf":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v21.6 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Tracing Flows through Virtual Networks and Service Instances in OpenStack and OpenContrail - Tungsten Fabric<\/title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/tungsten.io\/tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Tracing Flows through Virtual Networks and Service Instances in OpenStack and OpenContrail - Tungsten Fabric\" \/>\n<meta property=\"og:description\" content=\"This is a guest blog by\u00a0Johnny Chen from AT&amp;T with contributions by\u00a0Qasim Arham, Henon Huang, Vijay Kamisetty from Juniper Networks. Overview The purpose of this is to lay out a...\" \/>\n<meta property=\"og:url\" content=\"https:\/\/tungsten.io\/tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail\/\" \/>\n<meta property=\"og:site_name\" content=\"Tungsten Fabric\" \/>\n<meta property=\"article:published_time\" content=\"2016-07-21T00:25:54+00:00\" \/>\n<meta property=\"og:image\" content=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/07\/Tracing-Flows-through-Virtual-Networks-and-Service-Instances_background-drawings.jpg\" \/>\n<meta name=\"author\" content=\"Johnny Chen\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebPage\",\"@id\":\"https:\/\/tungsten.io\/tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail\/\",\"url\":\"https:\/\/tungsten.io\/tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail\/\",\"name\":\"Tracing Flows through Virtual Networks and Service Instances in OpenStack and OpenContrail - Tungsten Fabric\",\"isPartOf\":{\"@id\":\"https:\/\/tungsten.io\/#website\"},\"datePublished\":\"2016-07-21T00:25:54+00:00\",\"dateModified\":\"2016-07-21T00:25:54+00:00\",\"author\":{\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/5c28097a7e833234bd11351d03abfb7e\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/tungsten.io\/tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail\/\"]}]},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/tungsten.io\/#website\",\"url\":\"https:\/\/tungsten.io\/\",\"name\":\"Tungsten Fabric\",\"description\":\"multicloud multistack SDN\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https:\/\/tungsten.io\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"Person\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/5c28097a7e833234bd11351d03abfb7e\",\"name\":\"Johnny Chen\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/image\/\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/e8cc8e3495e84b7612293f01a82f9165?s=96&d=mm&r=pg\",\"contentUrl\":\"https:\/\/secure.gravatar.com\/avatar\/e8cc8e3495e84b7612293f01a82f9165?s=96&d=mm&r=pg\",\"caption\":\"Johnny Chen\"},\"url\":\"https:\/\/tungsten.io\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"Tracing Flows through Virtual Networks and Service Instances in OpenStack and OpenContrail - Tungsten Fabric","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/tungsten.io\/tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail\/","og_locale":"en_US","og_type":"article","og_title":"Tracing Flows through Virtual Networks and Service Instances in OpenStack and OpenContrail - Tungsten Fabric","og_description":"This is a guest blog by\u00a0Johnny Chen from AT&amp;T with contributions by\u00a0Qasim Arham, Henon Huang, Vijay Kamisetty from Juniper Networks. Overview The purpose of this is to lay out a...","og_url":"https:\/\/tungsten.io\/tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail\/","og_site_name":"Tungsten Fabric","article_published_time":"2016-07-21T00:25:54+00:00","og_image":[{"url":"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/07\/Tracing-Flows-through-Virtual-Networks-and-Service-Instances_background-drawings.jpg"}],"author":"Johnny Chen","twitter_card":"summary_large_image","schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebPage","@id":"https:\/\/tungsten.io\/tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail\/","url":"https:\/\/tungsten.io\/tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail\/","name":"Tracing Flows through Virtual Networks and Service Instances in OpenStack and OpenContrail - Tungsten Fabric","isPartOf":{"@id":"https:\/\/tungsten.io\/#website"},"datePublished":"2016-07-21T00:25:54+00:00","dateModified":"2016-07-21T00:25:54+00:00","author":{"@id":"https:\/\/tungsten.io\/#\/schema\/person\/5c28097a7e833234bd11351d03abfb7e"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/tungsten.io\/tracing-flows-through-virtual-networks-and-service-instances-in-openstack-and-opencontrail\/"]}]},{"@type":"WebSite","@id":"https:\/\/tungsten.io\/#website","url":"https:\/\/tungsten.io\/","name":"Tungsten Fabric","description":"multicloud multistack SDN","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https:\/\/tungsten.io\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Person","@id":"https:\/\/tungsten.io\/#\/schema\/person\/5c28097a7e833234bd11351d03abfb7e","name":"Johnny Chen","image":{"@type":"ImageObject","inLanguage":"en-US","@id":"https:\/\/tungsten.io\/#\/schema\/person\/image\/","url":"https:\/\/secure.gravatar.com\/avatar\/e8cc8e3495e84b7612293f01a82f9165?s=96&d=mm&r=pg","contentUrl":"https:\/\/secure.gravatar.com\/avatar\/e8cc8e3495e84b7612293f01a82f9165?s=96&d=mm&r=pg","caption":"Johnny Chen"},"url":"https:\/\/tungsten.io"}]}},"_links":{"self":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/7134"}],"collection":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/users\/491"}],"replies":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/comments?post=7134"}],"version-history":[{"count":0,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/7134\/revisions"}],"wp:attachment":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/media?parent=7134"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/categories?post=7134"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/tags?post=7134"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}