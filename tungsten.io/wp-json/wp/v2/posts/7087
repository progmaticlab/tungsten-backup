{"id":7087,"date":"2016-06-20T12:48:08","date_gmt":"2016-06-20T19:48:08","guid":{"rendered":"http:\/\/www.opencontrail.org\/?p=7087"},"modified":"2016-06-20T12:48:08","modified_gmt":"2016-06-20T19:48:08","slug":"contrail-integration-with-arista-tors-with-cloud-vision","status":"publish","type":"post","link":"https:\/\/tungsten.io\/contrail-integration-with-arista-tors-with-cloud-vision\/","title":{"rendered":"Openstack Bare Metal server integration using Contrail SDN in a multi vendor\u00a0DC fabric environment"},"content":{"rendered":"<h4>Introduction:<\/h4>\n<p>In this blog we are going to show a hands on lab demonstration of how Juniper Contrail SDN controller allows the cloud administrator\u00a0to seamlessly integrate Bare-metal servers into a virtualized network environment that may consist of existing virtual machine\u00a0workloads. The accompanying video shows the steps required to configure various features of this lab.<\/p>\n<p><iframe loading=\"lazy\" src=\"https:\/\/www.youtube.com\/embed\/PXHZAP1rXM0\" width=\"650\" height=\"370\" frameborder=\"0\" allowfullscreen=\"allowfullscreen\"><\/iframe><\/p>\n<p>The solution uses standards based OVSDB protocol to program the Ethernet Ports, VLANS and the MAC table entries on the\u00a0switches and hence any switch that supports OVSDB protocol can be used as the top of the rack switch to implement Contrail BMS\u00a0solution and we have already demonstrated one such solution with Cumulus Linux Switches in this <a href=\"https:\/\/www.youtube.com\/watch?v=PxG9Dfa1QkE\">video.<\/a><\/p>\n<p>Specifically, in this blog we are going to use QFX5100 and ARISTA as the two top of rack switches.<\/p>\n<h4>Setup:<\/h4>\n<p>The figure below shows the physical topology which consists of an all in one Contrail controller and compute node (IP=10.84.30.34)\u00a0where we are going to spin the VMs. The TSN node has a IP address of 10.84.30.33. The second server (10.84.30.33) is going to act as the\u00a0TSN node which is going to run the TOR agent (OVSDB clients) for the two TOR switches and also going to provide the network\u00a0services such as ARP\/DHCP\/DSN etc. to the bare-metal services through a service known as TOR services node. TSN node vRouter\u00a0forwarder translates the OVSDB message exchanges done with the TOR switches to XMPP messages which is advertised to the Control\u00a0node. This is done by vRouter forwarder agent running on the TSN node.<\/p>\n<p>The TWO switches QFX5100 (IP=10.84.30.44) &amp; Arista 7050 (IP=10.84.30.7.38) have one bare-metal servers connected to them on the 1G\u00a0interfaces as shown in the figure. In the case of Arista, the OVSDB session is established not with the TOR but with the cloudvision VM.\u00a0Cloudvision in turn is going to push the OVSDB state into the TOR switch using Arista&#8217;s cloudvision protocol. 10.84.0.0\/16 is DC fabric\u00a0underlay subnet. 10.84.63.144 is the loopback IP address of QFX5100 and for Arista switch it is 10.84.63.189.<\/p>\n<p>Finally, the MX SDN gateway (10.84.63.133) is also connected to the DC fabric. The MX gateway provides two main functionalities. 1.\u00a0Public access to VMs and bare-metal servers and 2. required to provide inter-VN connectivity between the bare-metal servers.<\/p>\n<p><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/Contrail-integration-with-Arista-TORs_blog_image1.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-7088\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/Contrail-integration-with-Arista-TORs_blog_image1.png\" alt=\"Contrail integration with Arista TORs_blog_image1\" width=\"800\" height=\"546\" data-id=\"7088\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<p>The MX gateway provides two main functionalities:1.\u00a0Public access to VMs and bare-metal servers and 2. required to provide inter-VN connectivity between the bare-metal servers.<\/p>\n<p>1.\u00a0Public access to VMs and bare-metal servers and 2. required to provide inter-VN connectivity between the bare-metal servers.<\/p>\n<p>2. required to provide inter-VN connectivity between the bare-metal servers.<\/p>\n<h4>Provisioning &amp; control-plane:<\/h4>\n<p>The TOR switches can be added to the cluster during provisioning of the cluster itself or can be added to an existing cluster using fab\u00a0tasks. The TSN and the TOR agent roles are configured under &#8216;tsn&#8217; and &#8216;toragent&#8217; roles in the env.roledefs section of testbed.py. All the\u00a0TOR switch related parameters such as the TOR switch loopback address (VXLAN VTEP source), OVSDB transport type (PSSL vs\u00a0TCP), OVSDB TCP port etc. is defined under the env.tor_agent section of testbed.py. Please refer the github link provided at in the\u00a0references section for more details.<\/p>\n<p>Once the cluster is provisioned along with the TOR switches the only other thing that is required is to configure the TOR switches with\u00a0the required configurations for OVSDB, VXLAN etc. Once all these are configured properly this should result in the control plane\u00a0protocols being established between the various nodes, TOR switches and the MX gateway. The configurations for the TOR switches\u00a0and the MX gateway is provided below.<\/p>\n<p>TSN has OVSDB sessions to QFX5100 &amp; the Arista cloudvision VM. TSN also has a XMPP session with the control node. Control and\u00a0MX gateway exchange BGP routes over the IBGP session.<\/p>\n<h4>Data Plane:<\/h4>\n<p>As one can see in the video we are going to create two virtual networks RED (IP Subnet 172.16.1.0\/24) and BLUE (IP Subnet\u00a0172.16.2.0\/24). QFX5100 ge-0\/0\/16 logical interface is added to the RED VN and the Arista switch Et3 interface is added to the BLUE\u00a0VN. In addition to this on the all in one contrail node we are going to create one VM each for the RED and the BLUE VNs.<\/p>\n<p>The resulting data-plane interactions are as shown in fig 3. The RED and BLUE VTEPs are created on the QFX5100 and Arista 7050\u00a0switches by OVSDB intra-VN communication between the bare-metal server and the virtual machine in the RED and BLUE VNs are\u00a0facilitated by the VXLAN tunnels that are setup between the TOR switches and the compute node (all in one node in this case\u00a010.84.30.34). Broadcast Ethernet frames for protocols such as ARP, DHCP etc., are directed towards the TSN node using VXLAN\u00a0tunnels established between the TOR switches and the TSN nodes. All the inter-VN traffic originated by the bare-metal server which is\u00a0destined to another bare-metal server or a VM in a different VN (RED to BLUE or vice versa) is sent to the EVPN instances for the\u00a0respective VNs on the MX SDN gateway wherein routing takes place between the RED and BLUE VRFs. The VRF and the EVPN\u00a0(virtual-switch routing-instance) configuration on the MX gateway is automated using the Contrail Device Manager feature.<\/p>\n<p>In addition to the all in one compute node has VXLAN and MPLSoGRE tunnels to the MX gateway for L2 and L3 stretch of the virtual\u00a0network.<\/p>\n<p><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/Contrail-integration-with-Arista-TORs_blog_image3.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-7090\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/Contrail-integration-with-Arista-TORs_blog_image3.png\" alt=\"Contrail integration with Arista TORs_blog_image3\" width=\"800\" height=\"547\" data-id=\"7090\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<p><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/Contrail-integration-with-Arista-TORs_blog_image4.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-7091\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/Contrail-integration-with-Arista-TORs_blog_image4.png\" alt=\"Contrail integration with Arista TORs_blog_image4\" width=\"800\" height=\"556\" data-id=\"7091\" \/><\/a><\/p>\n<p>Resulting logical tenant virtual network logical connectivity is as shown below.<\/p>\n<p><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/Contrail-integration-with-Arista-TORs_blog_image5.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-7092\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/Contrail-integration-with-Arista-TORs_blog_image5.png\" alt=\"Contrail integration with Arista TORs_blog_image5\" width=\"800\" height=\"676\" data-id=\"7092\" \/><\/a><\/p>\n<h4>References:<\/h4>\n<p>Sample testbed.py file &amp; the MX GW, QFX5100 , Arista Switch, Cloudvision configurations<br \/>\n<strong><a href=\"https:\/\/github.com\/vshenoy83\/Contrail-BMS-Configs.git\">https:\/\/github.com\/vshenoy83\/Contrail-BMS-Configs.git<\/a><\/strong><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Introduction: In this blog we are going to show a hands on lab demonstration of how Juniper Contrail SDN controller allows the cloud administrator\u00a0to seamlessly integrate Bare-metal servers into a&#8230;<\/p>\n","protected":false},"author":487,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[6,27,7,8,28],"tags":[],"acf":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v21.6 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Openstack Bare Metal server integration using Contrail SDN in a multi vendor\u00a0DC fabric environment - Tungsten Fabric<\/title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/tungsten.io\/contrail-integration-with-arista-tors-with-cloud-vision\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Openstack Bare Metal server integration using Contrail SDN in a multi vendor\u00a0DC fabric environment - Tungsten Fabric\" \/>\n<meta property=\"og:description\" content=\"Introduction: In this blog we are going to show a hands on lab demonstration of how Juniper Contrail SDN controller allows the cloud administrator\u00a0to seamlessly integrate Bare-metal servers into a...\" \/>\n<meta property=\"og:url\" content=\"https:\/\/tungsten.io\/contrail-integration-with-arista-tors-with-cloud-vision\/\" \/>\n<meta property=\"og:site_name\" content=\"Tungsten Fabric\" \/>\n<meta property=\"article:published_time\" content=\"2016-06-20T19:48:08+00:00\" \/>\n<meta property=\"og:image\" content=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/Contrail-integration-with-Arista-TORs_blog_image1.png\" \/>\n<meta name=\"author\" content=\"Vivekananda Shenoy\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebPage\",\"@id\":\"https:\/\/tungsten.io\/contrail-integration-with-arista-tors-with-cloud-vision\/\",\"url\":\"https:\/\/tungsten.io\/contrail-integration-with-arista-tors-with-cloud-vision\/\",\"name\":\"Openstack Bare Metal server integration using Contrail SDN in a multi vendor\u00a0DC fabric environment - Tungsten Fabric\",\"isPartOf\":{\"@id\":\"https:\/\/tungsten.io\/#website\"},\"datePublished\":\"2016-06-20T19:48:08+00:00\",\"dateModified\":\"2016-06-20T19:48:08+00:00\",\"author\":{\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/f9fb75fb71925ab248ee074c098c3b1b\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/tungsten.io\/contrail-integration-with-arista-tors-with-cloud-vision\/\"]}]},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/tungsten.io\/#website\",\"url\":\"https:\/\/tungsten.io\/\",\"name\":\"Tungsten Fabric\",\"description\":\"multicloud multistack SDN\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https:\/\/tungsten.io\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"Person\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/f9fb75fb71925ab248ee074c098c3b1b\",\"name\":\"Vivekananda Shenoy\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/image\/\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/7bf737562887a3a650fb532b763430a2?s=96&d=mm&r=pg\",\"contentUrl\":\"https:\/\/secure.gravatar.com\/avatar\/7bf737562887a3a650fb532b763430a2?s=96&d=mm&r=pg\",\"caption\":\"Vivekananda Shenoy\"},\"url\":\"https:\/\/tungsten.io\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"Openstack Bare Metal server integration using Contrail SDN in a multi vendor\u00a0DC fabric environment - Tungsten Fabric","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/tungsten.io\/contrail-integration-with-arista-tors-with-cloud-vision\/","og_locale":"en_US","og_type":"article","og_title":"Openstack Bare Metal server integration using Contrail SDN in a multi vendor\u00a0DC fabric environment - Tungsten Fabric","og_description":"Introduction: In this blog we are going to show a hands on lab demonstration of how Juniper Contrail SDN controller allows the cloud administrator\u00a0to seamlessly integrate Bare-metal servers into a...","og_url":"https:\/\/tungsten.io\/contrail-integration-with-arista-tors-with-cloud-vision\/","og_site_name":"Tungsten Fabric","article_published_time":"2016-06-20T19:48:08+00:00","og_image":[{"url":"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/Contrail-integration-with-Arista-TORs_blog_image1.png"}],"author":"Vivekananda Shenoy","twitter_card":"summary_large_image","schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebPage","@id":"https:\/\/tungsten.io\/contrail-integration-with-arista-tors-with-cloud-vision\/","url":"https:\/\/tungsten.io\/contrail-integration-with-arista-tors-with-cloud-vision\/","name":"Openstack Bare Metal server integration using Contrail SDN in a multi vendor\u00a0DC fabric environment - Tungsten Fabric","isPartOf":{"@id":"https:\/\/tungsten.io\/#website"},"datePublished":"2016-06-20T19:48:08+00:00","dateModified":"2016-06-20T19:48:08+00:00","author":{"@id":"https:\/\/tungsten.io\/#\/schema\/person\/f9fb75fb71925ab248ee074c098c3b1b"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/tungsten.io\/contrail-integration-with-arista-tors-with-cloud-vision\/"]}]},{"@type":"WebSite","@id":"https:\/\/tungsten.io\/#website","url":"https:\/\/tungsten.io\/","name":"Tungsten Fabric","description":"multicloud multistack SDN","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https:\/\/tungsten.io\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Person","@id":"https:\/\/tungsten.io\/#\/schema\/person\/f9fb75fb71925ab248ee074c098c3b1b","name":"Vivekananda Shenoy","image":{"@type":"ImageObject","inLanguage":"en-US","@id":"https:\/\/tungsten.io\/#\/schema\/person\/image\/","url":"https:\/\/secure.gravatar.com\/avatar\/7bf737562887a3a650fb532b763430a2?s=96&d=mm&r=pg","contentUrl":"https:\/\/secure.gravatar.com\/avatar\/7bf737562887a3a650fb532b763430a2?s=96&d=mm&r=pg","caption":"Vivekananda Shenoy"},"url":"https:\/\/tungsten.io"}]}},"_links":{"self":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/7087"}],"collection":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/users\/487"}],"replies":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/comments?post=7087"}],"version-history":[{"count":0,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/7087\/revisions"}],"wp:attachment":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/media?parent=7087"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/categories?post=7087"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/tags?post=7087"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}