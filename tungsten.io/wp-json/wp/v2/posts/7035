{"id":7035,"date":"2016-06-16T16:24:04","date_gmt":"2016-06-16T23:24:04","guid":{"rendered":"http:\/\/www.opencontrail.org\/?p=7035"},"modified":"2016-06-16T16:24:04","modified_gmt":"2016-06-16T23:24:04","slug":"opencontrail-in-service-software-upgrade","status":"publish","type":"post","link":"https:\/\/tungsten.io\/opencontrail-in-service-software-upgrade\/","title":{"rendered":"OpenContrail In Service Software Upgrade"},"content":{"rendered":"<p class=\"p0 ft0\">This blog goes over the procedure followed for In Service Software Upgrade of OpenContrail.<\/p>\n<p class=\"p0 ft1\">OpenContrail is an Openstack neutron plugin in the Openstack environment, and it primarily has two components, the Contrail controller services and the vRouter and associated services in the compute node. Since it is OpenContrail ISSU, we assume that OpenContrail and Openstack are installed in separate computational resources as shown in the Figure1 and can be upgraded independently. In this blog, we will go over procedure for OpenContrail In Service Software Upgrade from Version1 (V1) to Version2 (V2).<\/p>\n<p class=\"p0 ft1\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-1.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7068\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-1.png\" alt=\"OpenContrail ISS Upgrade Blog Image 1\" width=\"668\" height=\"487\" data-id=\"7068\" \/><\/a><\/p>\n<p class=\"p0 ft1\">As part of first step, spawn a parallel v2 Contrail controller cluster and launch ISSU task as shown in Figure2.<\/p>\n<p class=\"p0 ft1\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-2.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7069\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-2.png\" alt=\"OpenContrail ISS Upgrade Blog Image 2\" width=\"675\" height=\"402\" data-id=\"7069\" \/><\/a><\/p>\n<p class=\"p0 ft1\">ISSU task will first, BGP peer v1 and v2 controllers as shown in Figure3.<\/p>\n<p class=\"p0 ft1\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-3.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7070\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-3.png\" alt=\"OpenContrail ISS Upgrade Blog Image 3\" width=\"670\" height=\"417\" data-id=\"7070\" \/><\/a><\/p>\n<p class=\"p0 ft1\">Then ISSU task will freeze north bound communication of v1 Contrail controller cluster and start a run time ISSU sync as shown in Figure4. Note during this stage datapath is not impacted.<\/p>\n<p class=\"p0 ft1\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-4.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7071\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-4.png\" alt=\"OpenContrail ISS Upgrade Blog Image 4\" width=\"667\" height=\"406\" data-id=\"7071\" \/><\/a><\/p>\n<p class=\"p0 ft1\">Then it will open the northbound communication with Openstack as show in Figure5.<\/p>\n<p class=\"p0 ft1\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-5.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7072\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-5.png\" alt=\"OpenContrail ISS Upgrade Blog Image 5\" width=\"666\" height=\"402\" data-id=\"7072\" \/><\/a><\/p>\n<p class=\"p0 ft6\">Note the run time ISSU config sync and Contrail controller BGP peering ensures all the state generated in v1 Contrail controller cluster to be available in v2 Contrail controller cluster. Now system is ready for compute node upgrade.<\/p>\n<p class=\"p0 ft5\">Now admins can perform rolling upgrades of computes individually or in batches at a time as shown in figures 6 and 7. This will facilitate necessary testing that admin may intend to do before all computes upgrade.<\/p>\n<p class=\"p0 ft5\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-6.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7073\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-6.png\" alt=\"OpenContrail ISS Upgrade Blog Image 6\" width=\"666\" height=\"413\" data-id=\"7073\" \/><\/a><\/p>\n<p class=\"p0 ft5\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-7.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7074\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-7.png\" alt=\"OpenContrail ISS Upgrade Blog Image 7\" width=\"681\" height=\"414\" data-id=\"7074\" \/><\/a><\/p>\n<p class=\"p0 ft5\">Admin completes all compute upgrades as shown in Figure 8.<\/p>\n<p class=\"p0 ft5\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-8.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7075\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-8.png\" alt=\"OpenContrail ISS Upgrade Blog Image 8\" width=\"674\" height=\"403\" data-id=\"7075\" \/><\/a><\/p>\n<p class=\"p0 ft5\">Admin can also rollback the upgraded computes if some issue is detected, individually or in batches as shown in Figure 9.<\/p>\n<p class=\"p0 ft5\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-9.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7076\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-9.png\" alt=\"OpenContrail ISS Upgrade Blog Image 9\" width=\"667\" height=\"414\" data-id=\"7076\" \/><\/a><\/p>\n<p class=\"p0 ft5\">Once all computes are upgraded, admin can initiate decommissioning v1 Contrail controller cluster. For that, ISSU task will freeze the north bound communication of v1 Contrail controller with Openstack, does a final ISSU config sync of state as shown in Figure 10. It is not recommended to rollback from this step onwards.<\/p>\n<p class=\"p0 ft5\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-10.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7077\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-10.png\" alt=\"OpenContrail ISS Upgrade Blog Image 10\" width=\"667\" height=\"412\" data-id=\"7077\" \/><\/a><\/p>\n<p class=\"p0 ft5\">ISSU task finalizes the upgrade by decommissioning v1 Contrail Controller and set v2 Contrail controller as newer neutron plugin of Openstack as shown in Figure 11.<\/p>\n<p class=\"p0 ft5\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-11.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7078\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-11.png\" alt=\"OpenContrail ISS Upgrade Blog Image 11\" width=\"670\" height=\"407\" data-id=\"7078\" \/><\/a><\/p>\n<p class=\"p8 ft4\">ISSU task is terminated and the upgrade is done as shown in Figure 12.<\/p>\n<p class=\"p8 ft4\"><a href=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-12.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-7079\" src=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-12.png\" alt=\"OpenContrail ISS Upgrade Blog Image 12\" width=\"667\" height=\"408\" data-id=\"7079\" \/><\/a><\/p>\n<div id=\"page_7\">\n<p class=\"p0 ft1\">As you can see in the upgrade procedure, a hybrid approach is taken for the upgrade. Contrail controller cluster is side by side upgraded while computes are in place upgraded. Also communication between older version and newer version is over standard protocols like BGP or through ISSU task. This facilitates focused testing and less likely error prone.<\/p>\n<p class=\"p0 ft8\">Note all the Contrail Controller services including support services such as RabbitMQ, and database services such as Zookeeper and Cassandra and running in the same computational node is for illustrational purpose only. These support and database services could be running external to the Contrail controller and can be shared between old version and newer version, as they are logically partitioned and so old version and newer version don\u2019t step on each other.<\/p>\n<p class=\"p0 ft9\">In the below\u00a0screencast, all the support and database services are running in the Openstack Node. And HA proxy would be front ending neutron. This is to avoid touching Openstack components when the upgrade happens. For convenience ISSU task is running in v2 Contrail Controller. For convenience the whole procedure is driven through fabric scripts, which is referred as ISSU task.<\/p>\n<p><iframe loading=\"lazy\" src=\"https:\/\/www.youtube.com\/embed\/khAza3l8e6o\" width=\"600\" height=\"340\" frameborder=\"0\" allowfullscreen=\"allowfullscreen\"><\/iframe><\/p>\n<\/div>\n<div id=\"page_8\">\n<p class=\"p15 ft1\">In summary, a hybrid approach is taken here. Contrail controller cluster is side by side upgraded while computes are in place upgraded. Also communication between older version and newer version is over standard protocols like BGP or through ISSU task. This facilitates focused testing and less likely error prone. It is not a hitless upgrade, but it is a minimal hit upgrade with lots of flexibility for admins, for example connectivity to a VM that was spawned after upgraded is not impacted even after rollback!<\/p>\n<\/div>\n","protected":false},"excerpt":{"rendered":"<p>This blog goes over the procedure followed for In Service Software Upgrade of OpenContrail. OpenContrail is an Openstack neutron plugin in the Openstack environment, and it primarily has two components,&#8230;<\/p>\n","protected":false},"author":489,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[23,24,25],"tags":[],"acf":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v21.6 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>OpenContrail In Service Software Upgrade - Tungsten Fabric<\/title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/tungsten.io\/opencontrail-in-service-software-upgrade\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"OpenContrail In Service Software Upgrade - Tungsten Fabric\" \/>\n<meta property=\"og:description\" content=\"This blog goes over the procedure followed for In Service Software Upgrade of OpenContrail. OpenContrail is an Openstack neutron plugin in the Openstack environment, and it primarily has two components,...\" \/>\n<meta property=\"og:url\" content=\"https:\/\/tungsten.io\/opencontrail-in-service-software-upgrade\/\" \/>\n<meta property=\"og:site_name\" content=\"Tungsten Fabric\" \/>\n<meta property=\"article:published_time\" content=\"2016-06-16T23:24:04+00:00\" \/>\n<meta property=\"og:image\" content=\"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-1.png\" \/>\n<meta name=\"author\" content=\"Suresh Kumar Vinapamula Venkata\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebPage\",\"@id\":\"https:\/\/tungsten.io\/opencontrail-in-service-software-upgrade\/\",\"url\":\"https:\/\/tungsten.io\/opencontrail-in-service-software-upgrade\/\",\"name\":\"OpenContrail In Service Software Upgrade - Tungsten Fabric\",\"isPartOf\":{\"@id\":\"https:\/\/tungsten.io\/#website\"},\"datePublished\":\"2016-06-16T23:24:04+00:00\",\"dateModified\":\"2016-06-16T23:24:04+00:00\",\"author\":{\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/fb5840c961187b78d2113d0213e8c09a\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/tungsten.io\/opencontrail-in-service-software-upgrade\/\"]}]},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/tungsten.io\/#website\",\"url\":\"https:\/\/tungsten.io\/\",\"name\":\"Tungsten Fabric\",\"description\":\"multicloud multistack SDN\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https:\/\/tungsten.io\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"Person\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/fb5840c961187b78d2113d0213e8c09a\",\"name\":\"Suresh Kumar Vinapamula Venkata\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/image\/\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/aaa4cf8f190adeaa65e5d707445a2f5f?s=96&d=mm&r=pg\",\"contentUrl\":\"https:\/\/secure.gravatar.com\/avatar\/aaa4cf8f190adeaa65e5d707445a2f5f?s=96&d=mm&r=pg\",\"caption\":\"Suresh Kumar Vinapamula Venkata\"},\"url\":\"https:\/\/tungsten.io\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"OpenContrail In Service Software Upgrade - Tungsten Fabric","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/tungsten.io\/opencontrail-in-service-software-upgrade\/","og_locale":"en_US","og_type":"article","og_title":"OpenContrail In Service Software Upgrade - Tungsten Fabric","og_description":"This blog goes over the procedure followed for In Service Software Upgrade of OpenContrail. OpenContrail is an Openstack neutron plugin in the Openstack environment, and it primarily has two components,...","og_url":"https:\/\/tungsten.io\/opencontrail-in-service-software-upgrade\/","og_site_name":"Tungsten Fabric","article_published_time":"2016-06-16T23:24:04+00:00","og_image":[{"url":"http:\/\/www.opencontrail.org\/wp-content\/uploads\/2016\/06\/OpenContrail-ISS-Upgrade-Blog-Image-1.png"}],"author":"Suresh Kumar Vinapamula Venkata","twitter_card":"summary_large_image","schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebPage","@id":"https:\/\/tungsten.io\/opencontrail-in-service-software-upgrade\/","url":"https:\/\/tungsten.io\/opencontrail-in-service-software-upgrade\/","name":"OpenContrail In Service Software Upgrade - Tungsten Fabric","isPartOf":{"@id":"https:\/\/tungsten.io\/#website"},"datePublished":"2016-06-16T23:24:04+00:00","dateModified":"2016-06-16T23:24:04+00:00","author":{"@id":"https:\/\/tungsten.io\/#\/schema\/person\/fb5840c961187b78d2113d0213e8c09a"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/tungsten.io\/opencontrail-in-service-software-upgrade\/"]}]},{"@type":"WebSite","@id":"https:\/\/tungsten.io\/#website","url":"https:\/\/tungsten.io\/","name":"Tungsten Fabric","description":"multicloud multistack SDN","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https:\/\/tungsten.io\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Person","@id":"https:\/\/tungsten.io\/#\/schema\/person\/fb5840c961187b78d2113d0213e8c09a","name":"Suresh Kumar Vinapamula Venkata","image":{"@type":"ImageObject","inLanguage":"en-US","@id":"https:\/\/tungsten.io\/#\/schema\/person\/image\/","url":"https:\/\/secure.gravatar.com\/avatar\/aaa4cf8f190adeaa65e5d707445a2f5f?s=96&d=mm&r=pg","contentUrl":"https:\/\/secure.gravatar.com\/avatar\/aaa4cf8f190adeaa65e5d707445a2f5f?s=96&d=mm&r=pg","caption":"Suresh Kumar Vinapamula Venkata"},"url":"https:\/\/tungsten.io"}]}},"_links":{"self":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/7035"}],"collection":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/users\/489"}],"replies":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/comments?post=7035"}],"version-history":[{"count":0,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/7035\/revisions"}],"wp:attachment":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/media?parent=7035"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/categories?post=7035"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/tags?post=7035"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}