{"id":5165,"date":"2014-10-11T23:13:33","date_gmt":"2014-10-11T23:13:33","guid":{"rendered":"http:\/\/23.253.246.131\/?p=5165"},"modified":"2014-10-11T23:13:33","modified_gmt":"2014-10-11T23:13:33","slug":"automated-deployment-of-opencontrail-with-saltstack","status":"publish","type":"post","link":"https:\/\/tungsten.io\/automated-deployment-of-opencontrail-with-saltstack\/","title":{"rendered":"Automated deployment of OpenContrail with SaltStack"},"content":{"rendered":"<p><strong>Note<\/strong>: This is a post taken from\u00a0tcpcloud blog. <a href=\"http:\/\/tcpcloud.eu\/blog\/2014\/07\/21\/automation-deployment-opencontrail-saltstack\/\">Click here<\/a> for the original post.<\/p>\n<p id=\"magicdomid161\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">This week, tcp cloud\u00ae launched a new version of\u00a0<a style=\"font-weight: inherit; font-style: inherit; color: #666666;\" href=\"http:\/\/tcpcloud.eu\/en\/sluzby\/virtual-private-cloud\/\">TCP Virtual Private Cloud<\/a>\u00a0buil<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">t<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0on OpenContrail as SDN \/ NFV Controller. We decided for this\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">network setup<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">neutron plugin after spending more than 6 month of development and 2 month of production environment running\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">v<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">anilla OpenStack implementation with High Availability Neutron L3 Agent. We have worked at installation, development, testing and measuring\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">of<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">OpenContrail\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">networking\u00a0<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">since OpenStack Summit at Atlanta, where we saw it for\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">the\u00a0<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">first time. Our main contribution to this project was develop<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">ment of<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0automat<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">ed<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0deployment f<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">or\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">complete\u00a0<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">OpenStack\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">infrastrucute\u00a0<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">with OpenContrail as neutron plugin.\u00a0<\/span><\/p>\n<p><!--more Read more...--><\/p>\n<p id=\"magicdomid189\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">OpenContrail is released under an Apache 2.0 License by Juniper. To understand\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">how it works<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0you should read the\u00a0<a style=\"font-weight: inherit; font-style: inherit; color: #666666;\" href=\"http:\/\/opencontrail.org\/network-virtualization-architecture-deep-dive\/\">slides<\/a>\u00a0and overview at\u00a0<a style=\"font-weight: inherit; font-style: inherit; color: #666666;\" href=\"http:\/\/opencontrail.org\/\">opencontrail.org<\/a>, as well as the documentation available at juniper.net or the book\u00a0<a style=\"font-weight: inherit; font-style: inherit; color: #666666;\" href=\"http:\/\/opencontrail.org\/ebook\/\">Day One Understanding OpenContrail<\/a><\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">.<\/span><\/p>\n<p id=\"magicdomid24\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">This will be a mostly technical, but I will not talk about what OpenContrail actually does or how to deploy whole OpenStack or how powerful this solution really is. I am going to explain how to use our\u00a0<a style=\"font-weight: inherit; font-style: inherit; color: #666666;\" href=\"https:\/\/github.com\/tcpcloud\/salt-opencontrail-formula\">salt-opencontrail-formula<\/a>\u00a0for integration with an arbitrary OpenStack.\u00a0<\/span><\/p>\n<p id=\"magicdomid337\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">I have to say that it was a little bit challenge for us, because it is not common vendor plugin\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">that<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0we are used to<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0work with<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0and it is not actually\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">par<\/span><span class=\"author-g-q2r655an0iz122zk19nr\" style=\"font-weight: inherit; font-style: inherit;\">t<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0of the\u00a0<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">official OpenStack community<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0repositories?<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0(maybe in Juno release Contrail will be included\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">as<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0official vendor plugin<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">)<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">. As John Deatherage wrote at his\u00a0<a style=\"font-weight: inherit; font-style: inherit; color: #666666;\" href=\"http:\/\/workflowsherpas.com\/tag\/saltstack\/\">blog<\/a>, there\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">are\u00a0<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">several ways how you can deploy Contrail, but if you want to deploy it as production system you<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">should\u00a0<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">not use any\u00a0<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">o<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">f these<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">. The reason is that\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">the\u00a0<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">default deployment is done by\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">F<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">abric and installs whole Openstack environment<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0along the Contrail services<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">. You do not have possibility to customi<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">s<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">e t<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">he OpenStack part<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0and you do not know\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">how it<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0is actually configured. There is no official documentation for manual deployment except\u00a0<\/span><a style=\"font-weight: inherit; font-style: inherit; color: #666666;\" href=\"https:\/\/github.com\/Juniper\/contrail-controller\/wiki\/OpenContrail-bring-up-and-provisioning\"><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">G<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">it<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">H<\/span><\/a><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\"><a style=\"font-weight: inherit; font-style: inherit; color: #666666;\" href=\"https:\/\/github.com\/Juniper\/contrail-controller\/wiki\/OpenContrail-bring-up-and-provisioning\">ub<\/a>. OpenStack is modular system with various architectures and components. Therefore you should have possibility to<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">define properties. This is the reason why we refactored\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">the installation\u00a0<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">code from\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">F<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">abric and created a<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0new<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0S<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">alt<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">S<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">tack formula.<\/span><\/p>\n<h4 id=\"magicdomid375\" class=\"ace-line\" style=\"font-weight: 400; color: #666666;\"><strong><span class=\"author-g-uhee7ueykti1un5p b\" style=\"font-weight: inherit; font-style: inherit;\">PREPARE ENVIRONMENT<\/span><\/strong><\/h4>\n<p id=\"magicdomid355\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">We use RedHat based OpenStack Havana running on CentOS 6.4 and\u00a0<a style=\"font-weight: inherit; font-style: inherit; color: #666666;\" href=\"http:\/\/www.juniper.net\/support\/downloads\/?p=contrail#sw\">OpenContrail 1.05<\/a>. Download rpm package from juniper website and create local<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0YUM<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0repository for all nodes in infrastructure. Do not use RDO OpenStack Havana, because\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">Open<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Contrail\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">contains modified n<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">ova and\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">n<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">eutron<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0packages<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">. Basically you can prepare these\u00a0<\/span><span class=\"author-g-uuy56mu79filmshn\" style=\"font-weight: inherit; font-style: inherit;\">control nodes<\/span><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">\u00a0with CentOS 6.4:<\/span><\/p>\n<div id=\"magicdomid28\" class=\"ace-line\" style=\"color: #3c3d42;\">\n<ul style=\"font-weight: inherit; font-style: inherit;\">\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">OpenStack Controller \u2013 Keystone, Glance, Cinder, Nova, Dashboard, Swift, Heat, Ceilometer, etc.<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">OpenContrail Controller \u2013 Control node, Config node, Collector node, Neutron.<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">OpenStack Compute node \u2013 Nova compute, OpenContrail compute (vRouter).<\/span><\/li>\n<\/ul>\n<\/div>\n<p id=\"magicdomid31\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Default Fabric automation runs setup_all with following set of tasks:<\/span><\/p>\n<div id=\"magicdomid32\" class=\"ace-line\" style=\"color: #3c3d42;\">\n<ul style=\"font-weight: inherit; font-style: inherit;\">\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018setup_all\u2019<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018bash_autocomplete_systemd\u2019<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018setup_database\u2019<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018setup_openstack\u2019<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018setup_cfgm\u2019<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018setup_control\u2019<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018setup_collector\u2019<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018setup_webui\u2019<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018setup_vrouter\u2019<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018prov_control_bgp\u2019<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018prov_external_bgp\u2019<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Executing task \u2018compute_reboot\u2019<\/span><\/li>\n<\/ul>\n<\/div>\n<p id=\"magicdomid356\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Against them we have created these sls roles, which can be use independently and even redundantly for high availability (e.g. 2 control nodes):<\/span><\/p>\n<div id=\"magicdomid45\" class=\"ace-line\" style=\"color: #3c3d42;\">\n<ul style=\"font-weight: inherit; font-style: inherit;\">\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">common.sls \u2013 common configuration for all roles.<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">database.sls \u2013 configuration of the OpenContrail database.<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">config.sls \u2013 install and configure config node.<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">control.sls \u2013 install and configure control node.<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">collector.sls \u2013 install and configure collector node.<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">compute.sls \u2013 install and configure compute node.<\/span><\/li>\n<li style=\"font-style: inherit;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">web.sls \u2013 install modules into OpenStack Dashboard (Horizon).<\/span><\/li>\n<\/ul>\n<\/div>\n<p id=\"magicdomid1280\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">I cover just formula and installation for OpenContrail, but in tcp cloud we have created formulas for whole OpenStack environment including keystone, mysql, gla<\/span>nce, cinder, nova, heat with modular neutron, cinder and nova plugins. These formulas might\u00a0<span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">be released in the future. They are included inside of product TCP Private Cloud. For this purpose I describe manual changes inside of OpenStack configuration files that are different from\u00a0<\/span><span class=\"author-g-uhee7ueykti1un5p url\" style=\"font-weight: inherit; font-style: inherit;\"><a style=\"font-weight: inherit; font-style: inherit; color: #666666;\" href=\"http:\/\/docs.openstack.org\/\">http:\/\/docs.openstack.org<\/a><\/span><\/p>\n<h4 id=\"magicdomid1560\" class=\"ace-line\" style=\"font-weight: 400; color: #666666;\"><span class=\"author-g-uhee7ueykti1un5p b\" style=\"font-weight: inherit; font-style: inherit;\"><strong>DEPLOY OPENSTACK<\/strong><\/span><\/h4>\n<p id=\"magicdomid1127\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">You should install OpenStack environment (Contrail repository only) and customized these specific projects:<\/span><\/p>\n<p id=\"magicdomid729\" class=\"ace-line\" style=\"color: #666666;\"><strong><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-style: inherit;\">NOVA<\/span><\/strong><\/p>\n<p id=\"magicdomid1157\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">set libvirt vif driver in \/etc\/nova.conf at Controller and Compute node.<\/span><\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code>libvirt_vif_driver = nova_contrail_vif.contrailvif.VRouterVIFDriver\u00a0<\/code><\/span><\/pre>\n<p id=\"magicdomid723\" class=\"ace-line\" style=\"color: #666666;\"><strong><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-style: inherit;\">NEUTRON<\/span><\/strong><\/p>\n<p id=\"magicdomid1153\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Install openstack-neutron-server and openstack-neutron-contrail at Controller node. There must be configured:\u00a0<\/span><\/p>\n<p id=\"magicdomid560\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">neutron.conf<\/span><\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code>core_plugin = neutron.plugins.juniper.contrail.contrailplugin.ContrailPlugin<\/code><\/span><\/pre>\n<pre><span style=\"color: #3c3d42; font-family: 'courier new', courier;\"> \/etc\/neutron\/plugins\/opencontrail\/ContrailPlugin.ini\u00a0<\/span>\n<span style=\"font-family: 'courier new', courier;\"> <code>[APISERVER]\n api_server_ip = 10.0.106.34\n api_server_port = 8082\n multi_tenancy = False<\/code><\/span><\/pre>\n<pre><span style=\"font-family: 'courier new', courier;\"><code> [KEYSTONE]\n admin_user=admin\n admin_password=pswd\n admin_tenant_name=admin<\/code><\/span><\/pre>\n<p id=\"magicdomid777\" class=\"ace-line\" style=\"color: #666666;\"><strong><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-style: inherit;\">HORIZON<\/span><\/strong><\/p>\n<p id=\"magicdomid1174\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Install contrail-openstack-dashboard and verify these modules \/etc\/openstack-dashboard\/local_settings\u00a0<\/span><\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code>HORIZON_CONFIG['customization_module'] = 'contrail_openstack_dashboard.overrides'<\/code><\/span><\/pre>\n<h4 id=\"magicdomid1309\" class=\"ace-line\" style=\"font-weight: 400; color: #666666;\"><span class=\"author-g-uhee7ueykti1un5p b\" style=\"font-weight: inherit; font-style: inherit;\"><strong>PREPARE OPENCONTRAIL CONTROLLER<\/strong><\/span><\/h4>\n<p id=\"magicdomid1558\" class=\"ace-line\" style=\"color: #3c3d42;\"><span class=\"author-g-uhee7ueykti1un5p\" style=\"font-weight: inherit; font-style: inherit;\">Because of standalone solution, you have to install basic rabbitmq-server and cassandra with default settings. Next there must be haproxy enabling options for HA. These are separate saltstack formulas, so manually configure haproxy.conf<\/span><\/p>\n<h4 id=\"magicdomid1180\" class=\"ace-line\" style=\"font-weight: 400; color: #666666;\"><span class=\"author-g-uhee7ueykti1un5p b\" style=\"font-weight: inherit; font-style: inherit;\"><strong>CREATE PILLAR FOR ROLES<\/strong><\/span><\/h4>\n<p style=\"color: #3c3d42;\">Now you have to create pillar with definition for all roles located at OpenContrail controller. As you can see, some definitions are repeated, because roles are independent and can run on different servers and scale up.<\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code> opencontrail:\n common:\n identity:\n engine: keystone\n host: 10.0.106.30\n port: 35357\n token: pwd\n password: pwd\n network:\n engine: neutron\n host: 10.0.106.34\n port: 9696\n config:\n enabled: true\n id: 1\n network:\n engine: neutron\n host: 10.0.106.34\n port: 9696\n bind:\n address: 10.0.106.34\n database:\n members:\n - host: 10.0.106.34\n port: 9160\n cache:\n host: 10.0.106.34\n identity:\n engine: keystone\n region: RegionOne\n host: 10.0.106.30\n port: 35357\n user: admin\n password: pwd\n token: pwd\n tenant: admin\n members:\n - host: 10.0.106.34\n id: 1\n control:\n enabled: true\n bind:\n address: 10.0.106.34\n master:\n host: 10.0.106.34\n members:\n - host: 10.0.106.34\n id: 1\n collector:\n enabled: true\n bind:\n address: 10.0.106.34\n master:\n host: 10.0.106.34\n database:\n members:\n - host: 10.0.106.34\n port: 9160\n database:\n enabled: true\n name: 'Contrail'\n original_token: 0\n data_dirs:\n - \/home\/cassandra\n bind:\n host: 10.0.106.34\n port: 9042\n rpc_port: 9160\n members:\n - 10.0.106.34\n web:\n enabled: True\n bind:\n address: 10.0.106.34\n master:\n host: 10.0.106.34\n cache:\n engine: redis\n host: 10.0.106.34\n port: 6379\n members:\n - host: 10.0.106.34\n id: 1\n identity:\n engine: keystone\n host: 10.0.106.30\n port: 35357\n user: admin\n password: pwd\n token: pwd\n tenant: admin<\/code><\/span><\/pre>\n<p>OpenStack Controller:<\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code> opencontrail:\n common:\n identity:\n engine: keystone\n host: 10.0.106.30\n port: 35357\n token: pwd\n password: pwd\n network:\n engine: neutron\n host: 10.0.106.34\n port: 9696<\/code><\/span><\/pre>\n<p>OpenStack Compute<\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code> opencontrail:\n common:\n identity:\n engine: keystone\n host: 10.0.106.30\n port: 35357\n token: pwd\n password: pwd\n network:\n engine: neutron\n host: 10.0.106.34\n port: 9697\n compute:\n enabled: True\n hostname: compute1\n discovery:\n host: 10.0.106.34\n interface:\n dev: bond0\n default_pmac: a0:36:9f:02:95:2c\n address: 10.0.106.102\n gateway: 10.0.106.1\n mask: 24\n dns: 8.8.8.8\n mtu: 9000\n control_instances: 1<\/code><\/span><\/pre>\n<h4>Deploy OpenContrail<\/h4>\n<p>Run this command at all infrastructure nodes:<\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code>salt-call state.sls opencontrail<\/code><\/span><\/pre>\n<h4>Deploy Compute nodes<\/h4>\n<p>Add virtual router<\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code>python \/etc\/contrail\/provision_vrouter.py --host_name compute1 --host_ip 10.0.106.106\n --api_server_ip 10.0.106.34 --oper add --admin_user admin --admin_password pwd --admin_tenant_name admin<\/code><\/span><\/pre>\n<h4>ADD CONTROL BGP<\/h4>\n<p>Finally you have to add control BGP through python script stored in \/etc\/contrail at OpenContrail Controller:<\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code>python \/etc\/contrail\/provision_control.py --api_server_ip 10.0.106.34 --api_server_port\n 8082 --host_name network1.contrail.domain.com --host_ip 10.0.106.34 --router_asn 64512<\/code><\/span><\/pre>\n<p>Now you should have OpenContrail deployed. Run your instance first instance and try the amazing network performance. For whole automation contact us for <a href=\"http:\/\/tcpcloud.eu\/en\/sluzby\/private-cloud\/#inquiry\">Private Cloud<\/a><\/p>\n<p>Jakub Pavl\u00edk &#8211; @JakubPav<br \/>\nTCP Cloud platform engineer<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Note: This is a post taken from\u00a0tcpcloud blog. Click here for the original post. This week, tcp cloud\u00ae launched a new version of\u00a0TCP Virtual Private Cloud\u00a0built\u00a0on OpenContrail as SDN \/&#8230;<\/p>\n","protected":false},"author":479,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[12,1],"tags":[],"acf":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v21.6 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Automated deployment of OpenContrail with SaltStack - Tungsten Fabric<\/title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/tungsten.io\/automated-deployment-of-opencontrail-with-saltstack\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Automated deployment of OpenContrail with SaltStack - Tungsten Fabric\" \/>\n<meta property=\"og:description\" content=\"Note: This is a post taken from\u00a0tcpcloud blog. Click here for the original post. This week, tcp cloud\u00ae launched a new version of\u00a0TCP Virtual Private Cloud\u00a0built\u00a0on OpenContrail as SDN \/...\" \/>\n<meta property=\"og:url\" content=\"https:\/\/tungsten.io\/automated-deployment-of-opencontrail-with-saltstack\/\" \/>\n<meta property=\"og:site_name\" content=\"Tungsten Fabric\" \/>\n<meta property=\"article:published_time\" content=\"2014-10-11T23:13:33+00:00\" \/>\n<meta name=\"author\" content=\"Jakub Pavlik\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebPage\",\"@id\":\"https:\/\/tungsten.io\/automated-deployment-of-opencontrail-with-saltstack\/\",\"url\":\"https:\/\/tungsten.io\/automated-deployment-of-opencontrail-with-saltstack\/\",\"name\":\"Automated deployment of OpenContrail with SaltStack - Tungsten Fabric\",\"isPartOf\":{\"@id\":\"https:\/\/tungsten.io\/#website\"},\"datePublished\":\"2014-10-11T23:13:33+00:00\",\"dateModified\":\"2014-10-11T23:13:33+00:00\",\"author\":{\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/fa242938c01e9144363e911cf07ecd75\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/tungsten.io\/automated-deployment-of-opencontrail-with-saltstack\/\"]}]},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/tungsten.io\/#website\",\"url\":\"https:\/\/tungsten.io\/\",\"name\":\"Tungsten Fabric\",\"description\":\"multicloud multistack SDN\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https:\/\/tungsten.io\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"Person\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/fa242938c01e9144363e911cf07ecd75\",\"name\":\"Jakub Pavlik\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/image\/\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/0fe1e918e30d022ef4c9895cc59c9d7f?s=96&d=mm&r=pg\",\"contentUrl\":\"https:\/\/secure.gravatar.com\/avatar\/0fe1e918e30d022ef4c9895cc59c9d7f?s=96&d=mm&r=pg\",\"caption\":\"Jakub Pavlik\"},\"url\":\"https:\/\/tungsten.io\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"Automated deployment of OpenContrail with SaltStack - Tungsten Fabric","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/tungsten.io\/automated-deployment-of-opencontrail-with-saltstack\/","og_locale":"en_US","og_type":"article","og_title":"Automated deployment of OpenContrail with SaltStack - Tungsten Fabric","og_description":"Note: This is a post taken from\u00a0tcpcloud blog. Click here for the original post. This week, tcp cloud\u00ae launched a new version of\u00a0TCP Virtual Private Cloud\u00a0built\u00a0on OpenContrail as SDN \/...","og_url":"https:\/\/tungsten.io\/automated-deployment-of-opencontrail-with-saltstack\/","og_site_name":"Tungsten Fabric","article_published_time":"2014-10-11T23:13:33+00:00","author":"Jakub Pavlik","twitter_card":"summary_large_image","schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebPage","@id":"https:\/\/tungsten.io\/automated-deployment-of-opencontrail-with-saltstack\/","url":"https:\/\/tungsten.io\/automated-deployment-of-opencontrail-with-saltstack\/","name":"Automated deployment of OpenContrail with SaltStack - Tungsten Fabric","isPartOf":{"@id":"https:\/\/tungsten.io\/#website"},"datePublished":"2014-10-11T23:13:33+00:00","dateModified":"2014-10-11T23:13:33+00:00","author":{"@id":"https:\/\/tungsten.io\/#\/schema\/person\/fa242938c01e9144363e911cf07ecd75"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/tungsten.io\/automated-deployment-of-opencontrail-with-saltstack\/"]}]},{"@type":"WebSite","@id":"https:\/\/tungsten.io\/#website","url":"https:\/\/tungsten.io\/","name":"Tungsten Fabric","description":"multicloud multistack SDN","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https:\/\/tungsten.io\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Person","@id":"https:\/\/tungsten.io\/#\/schema\/person\/fa242938c01e9144363e911cf07ecd75","name":"Jakub Pavlik","image":{"@type":"ImageObject","inLanguage":"en-US","@id":"https:\/\/tungsten.io\/#\/schema\/person\/image\/","url":"https:\/\/secure.gravatar.com\/avatar\/0fe1e918e30d022ef4c9895cc59c9d7f?s=96&d=mm&r=pg","contentUrl":"https:\/\/secure.gravatar.com\/avatar\/0fe1e918e30d022ef4c9895cc59c9d7f?s=96&d=mm&r=pg","caption":"Jakub Pavlik"},"url":"https:\/\/tungsten.io"}]}},"_links":{"self":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/5165"}],"collection":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/users\/479"}],"replies":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/comments?post=5165"}],"version-history":[{"count":0,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/5165\/revisions"}],"wp:attachment":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/media?parent=5165"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/categories?post=5165"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/tags?post=5165"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}