{"id":1307,"date":"2014-03-03T19:46:42","date_gmt":"2014-03-03T19:46:42","guid":{"rendered":"http:\/\/opencontrail.org\/?p=1307"},"modified":"2014-03-03T19:46:42","modified_gmt":"2014-03-03T19:46:42","slug":"application-specific-networking","status":"publish","type":"post","link":"https:\/\/tungsten.io\/application-specific-networking\/","title":{"rendered":"Application specific networking"},"content":{"rendered":"<p style=\"text-align: justify;\">Linux <a href=\"http:\/\/man7.org\/linux\/man-pages\/man8\/ip-netns.8.html\">namespaces<\/a>\u00a0and <a href=\"http:\/\/opencontrail.org\">OpenContrail<\/a>\u00a0can be combined to create application specific networks where a specific process on a Linux host can be associated with a virtual-network.<\/p>\n<p><!--more Read more...--><\/p>\n<p style=\"text-align: justify;\">With OpenContrail this application can be placed directly in a Layer 3 VPN which can extend across the WAN; load-balancing can be performed via \u201cfloating-ip\u201d addresses associated with multiple instances of the application; routing between virtual-networks is performed in a fully distributed manner; ACLs can be configured; and flow records are collected in a time-series data-base for subsequent analysis.<\/p>\n<p style=\"text-align: justify;\">As an example, lets start an apache web server in a virtual-network on a Linux machine.<\/p>\n<p style=\"text-align: justify;\">The first step is to install OpenContrail in the machine. This can be achieved via a binary distribution or by compiling the source code and manually installing.<\/p>\n<p style=\"text-align: justify;\">This <a href=\"https:\/\/github.com\/dsetia\/devstack\/blob\/master\/lib\/neutron_thirdparty\/contrail\">script<\/a>\u00a0contains all the steps involved in preparing a build VM, compiling the code and starting the software. While it has been developed to run as part of <a href=\"https:\/\/github.com\/openstack-dev\/devstack\">devstack<\/a> it can be executed independently. OpenContrail can run independently of OpenStack\/CloudStack. For a production deployment, you will need to start the configuration and control components of OpenContrail in a couple of servers (for redundancy). For test purposes one can run the configuration, control and virtual router components in the same server.<\/p>\n<p style=\"text-align: justify;\">Once the software is installed, one needs to define application instances and their networking properties using the contrail API.<\/p>\n<p style=\"text-align: justify;\">This <a href=\"https:\/\/github.com\/Juniper\/contrail-controller\/blob\/master\/src\/config\/api-server\/tests\/test_instance_ctl.py\">script<\/a>\u00a0contains an example of how to define an instance and associate it with a virtual-network. The contrail configuration management component allocates an IP address and mac address for the application instance. Currently the API uses the terminology \u201cvirtual-machine\u201d and \u201cvirtual-machine-interface\u201d but there the implementation supports any kind of application instance.<\/p>\n<p style=\"text-align: justify;\">Next we need to define a networking namespace on the server running the application:<\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code> ip link add veth0 type veth peer name veth1\n ip netns add service-1\n ip link set veth0 netns service-1<\/code><\/span><\/pre>\n<p style=\"text-align: justify;\">And associate the \u201cveth1\u2033 interface with the \u201cvirtual-machine-interface\u201d created on the OpenContrail configuration API. This <a href=\"https:\/\/github.com\/Juniper\/vrouter-xen-utils\/blob\/master\/vrouter-ctl\">script<\/a> can be invoked with the VM and VMI uuids created above. It takes as arguments the VM uuid and VMI uuid and veth1.<\/p>\n<p style=\"text-align: justify;\">Once this is done, the veth1 interface should be visible in the OpenContrail vrouter agent (<a href=\"http:\/\/server-ip:8085\/Snh_ItfReq?name=veth1\" rel=\"nofollow\">http:\/\/server-ip:8085\/Snh_ItfReq?name=veth1<\/a>).<\/p>\n<p style=\"text-align: justify;\">Now we need to configure the veth0 mac and set the peer up. It is important that the veth0 mac address be the same address as defined for the \u201cvirtual-machine-interface\u201d on the contrail API. Incoming traffic will be rejected by the Linux kernel otherwise.<\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code> ip netns exec service-1 ifconfig veth0 hw ether xx:xx:xx:xx:xx:xx\n ip set link veth1 up<\/code><\/span><\/pre>\n<p style=\"text-align: justify;\">Now we can setup the networking on the namespace:<\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code>ip netns exec service-1 dhclient veth0<\/code><\/span><\/pre>\n<p style=\"text-align: justify;\">And start an application:<\/p>\n<pre><span style=\"font-family: 'courier new', courier;\"><code>APACHE_LOG_DIR=\/var\/log\/httpd APACHE_RUN_USER=www-data APACHE_RUN_GROUP=www-data sudo -E ip netns exec service-1 \/usr\/sbin\/apache2<\/code><\/span><\/pre>\n<p style=\"text-align: justify;\">Once this is done any other host in the virtual-network should be able to access this HTTP server. OpenContrail network policies can then be used to define connectivity between virtual-networks as well as access control lists (ACLs). And OpenContrail\u2019s standards based interoperability means that the virtual network can be extended from the overlay to a WAN via any <a href=\"http:\/\/tools.ietf.org\/html\/rfc4364\">RFC 4364<\/a> capable router.<\/p>\n<p style=\"text-align: justify;\">OpenContrail is a great replacement for the current combination of haproxy, vrrp, ipchains, dnsmasq and who-knows what else is currently necessary to deploy a load balanced application.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Linux namespaces\u00a0and OpenContrail\u00a0can be combined to create application specific networks where a specific process on a Linux host can be associated with a virtual-network.<\/p>\n","protected":false},"author":458,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[1],"tags":[],"acf":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v21.6 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Application specific networking - Tungsten Fabric<\/title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/tungsten.io\/application-specific-networking\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Application specific networking - Tungsten Fabric\" \/>\n<meta property=\"og:description\" content=\"Linux namespaces\u00a0and OpenContrail\u00a0can be combined to create application specific networks where a specific process on a Linux host can be associated with a virtual-network.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/tungsten.io\/application-specific-networking\/\" \/>\n<meta property=\"og:site_name\" content=\"Tungsten Fabric\" \/>\n<meta property=\"article:published_time\" content=\"2014-03-03T19:46:42+00:00\" \/>\n<meta name=\"author\" content=\"Pedro Marques\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebPage\",\"@id\":\"https:\/\/tungsten.io\/application-specific-networking\/\",\"url\":\"https:\/\/tungsten.io\/application-specific-networking\/\",\"name\":\"Application specific networking - Tungsten Fabric\",\"isPartOf\":{\"@id\":\"https:\/\/tungsten.io\/#website\"},\"datePublished\":\"2014-03-03T19:46:42+00:00\",\"dateModified\":\"2014-03-03T19:46:42+00:00\",\"author\":{\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/4482c87f5bb06e7236ba1ff004df8def\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/tungsten.io\/application-specific-networking\/\"]}]},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/tungsten.io\/#website\",\"url\":\"https:\/\/tungsten.io\/\",\"name\":\"Tungsten Fabric\",\"description\":\"multicloud multistack SDN\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https:\/\/tungsten.io\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"Person\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/4482c87f5bb06e7236ba1ff004df8def\",\"name\":\"Pedro Marques\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https:\/\/tungsten.io\/#\/schema\/person\/image\/\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/6e92702fd500d2259b81e6285c050e68?s=96&d=mm&r=pg\",\"contentUrl\":\"https:\/\/secure.gravatar.com\/avatar\/6e92702fd500d2259b81e6285c050e68?s=96&d=mm&r=pg\",\"caption\":\"Pedro Marques\"},\"url\":\"https:\/\/tungsten.io\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"Application specific networking - Tungsten Fabric","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/tungsten.io\/application-specific-networking\/","og_locale":"en_US","og_type":"article","og_title":"Application specific networking - Tungsten Fabric","og_description":"Linux namespaces\u00a0and OpenContrail\u00a0can be combined to create application specific networks where a specific process on a Linux host can be associated with a virtual-network.","og_url":"https:\/\/tungsten.io\/application-specific-networking\/","og_site_name":"Tungsten Fabric","article_published_time":"2014-03-03T19:46:42+00:00","author":"Pedro Marques","twitter_card":"summary_large_image","schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebPage","@id":"https:\/\/tungsten.io\/application-specific-networking\/","url":"https:\/\/tungsten.io\/application-specific-networking\/","name":"Application specific networking - Tungsten Fabric","isPartOf":{"@id":"https:\/\/tungsten.io\/#website"},"datePublished":"2014-03-03T19:46:42+00:00","dateModified":"2014-03-03T19:46:42+00:00","author":{"@id":"https:\/\/tungsten.io\/#\/schema\/person\/4482c87f5bb06e7236ba1ff004df8def"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/tungsten.io\/application-specific-networking\/"]}]},{"@type":"WebSite","@id":"https:\/\/tungsten.io\/#website","url":"https:\/\/tungsten.io\/","name":"Tungsten Fabric","description":"multicloud multistack SDN","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https:\/\/tungsten.io\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Person","@id":"https:\/\/tungsten.io\/#\/schema\/person\/4482c87f5bb06e7236ba1ff004df8def","name":"Pedro Marques","image":{"@type":"ImageObject","inLanguage":"en-US","@id":"https:\/\/tungsten.io\/#\/schema\/person\/image\/","url":"https:\/\/secure.gravatar.com\/avatar\/6e92702fd500d2259b81e6285c050e68?s=96&d=mm&r=pg","contentUrl":"https:\/\/secure.gravatar.com\/avatar\/6e92702fd500d2259b81e6285c050e68?s=96&d=mm&r=pg","caption":"Pedro Marques"},"url":"https:\/\/tungsten.io"}]}},"_links":{"self":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/1307"}],"collection":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/users\/458"}],"replies":[{"embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/comments?post=1307"}],"version-history":[{"count":0,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/posts\/1307\/revisions"}],"wp:attachment":[{"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/media?parent=1307"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/categories?post=1307"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/tungsten.io\/wp-json\/wp\/v2\/tags?post=1307"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}